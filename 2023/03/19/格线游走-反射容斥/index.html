<head>
    <title> 格线游走/反射容斥 - WyyOIer </title>
  	<link rel="stylesheet" href="/css/main.css">
  	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script type = "text/javascript" async src="/javascript/main.js"></script>
    <script id="MathJax-script" async src="/javascript/math/tex-mml-chtml.js"></script>
    <script src="/javascript/jquery-3.6.0.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>


   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeBlockFuction.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeCopy.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/clipboard.min.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeShrink.js"></script> -->
   <!-- <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style> -->

    <!-- <link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css"> -->
    
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <script id="Valine" src='https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js'></script>
<meta name="generator" content="Hexo 6.2.0"><link rel="stylesheet" href="/css/prism-sh.css" type="text/css"></head>

<body>


<div id = "background">
    <div id = "index">
        <div id="menu">

    <div style="text-align: center;font-size: 32px;font-family: consolas;">
        <p>WyyOIer</p>
    </div>

    <div style="height: 150px;float: up;display: flex;flex-direction: column;align-items: center;">
        <div id="headstyle">
            
        </div>
    </div>
	
    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "pcount" title = "文章数" style = "font-family: consolas;font-size: 20px;">26</text>
    </div>

    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "commentcount" title = "评论数" style = "font-family: consolas;font-size: 20px;">0</text>
    </div>

    <div style="height: 50px;width: 40%;float: left;text-align: center;">
        <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/159610">
        <img src="https://www.luogu.com.cn/favicon.ico" alt="洛谷" width="24" height="24"></a>
        &nbsp; 
        <a target="_blank" rel="noopener" href="https://codeforces.com/profile/WyyOIer">
        <img src="https://codeforces.com/favicon.ico" alt="CF" width="24" height="24"></a>
    </div>


    <div class="list-group">
        <a class="list-group-item" href="/"><i class="fa fa-home fa-fw"></i>&nbsp; 首页</a>
        <a class="list-group-item" href="/about"><i class="fa fa-user fa-fw"></i>&nbsp; 关于</a>
        <a class="list-group-item" href="/links"><i class="fa fa-link fa-fw"></i>&nbsp; 友链</a>
        <a class="list-group-item" onclick = "Search()"><i class="fa fa-search fa-fw"></i>&nbsp; 搜索</a>
        <a class="list-group-item" href="/source"><i class="fa fa-code fa-fw"></i>&nbsp; 代码</a>
        <a class="list-group-item" href="/config"><i class="fa fa-cog fa-fw"></i>&nbsp; 设置</a>
    </div>

    <script>
        function changemusicid(){
            var v = document.getElementById("num").value, text, f = 0;
            if(v == null || v == "") {
            text = "输入不能为空。";
            f = 1;
            }
            if(f == 0) document.getElementById("music").innerHTML= '<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=250 height=95 src="//music.163.com/outchain/player?type=2&id=' + v + '&auto=0&height=66"></iframe> ';
            else document.getElementById("musictext").innerHTML = text;
        }
    </script>

    <div style="height: 13%;width: 30%;float: left" id="music">
    <!-- <input id = "num" placeholder = "输入网易音乐 id，如 480517594" style = "width: 230px;"> -->
    <!-- <button type="button" onclick="changemusicid()">提交</button> -->
    <!-- <p id = "musictext"></p> -->
    </div>

</div>


    </div>

    

    


    

        <div id = "article">
            <div id = "post-title"> 格线游走/反射容斥 </div>
            <div id = "post-author"> By WyyOIer | </div>
            <div id = "post-date" title = "发布时间"> 2023-03-19 10:35:04 / </div>
            <div id = "post-updated" title = "更新时间"> 2023-03-20 22:37:55 </div>
            <span class = "leancloud_visitors" id = "/2023/03/19/%E6%A0%BC%E7%BA%BF%E6%B8%B8%E8%B5%B0-%E5%8F%8D%E5%B0%84%E5%AE%B9%E6%96%A5/">
                <text class="post-meta-item-text">阅读数 </text>
                <i class="leancloud-visitors-count">nan</i>
            </span>
            <br>
            <h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><p>请思考如下的经典问题：从原点 $(0,0)$ 开始，每一步只能向右或向上走，问走到 $A(n,m)$ 的方案数有多少？</p>
<img src="https://cdnjson.com/images/2023/03/20/1.png" alt="图1.png" style="zoom: 80%;" />

<p>相信大家都能一眼得出方案数为 ${n+m\choose n}$，组合意义也十分显然：将向右和向上看作 $01$ 操作，那么就是求由 $n$ 个 $0$、$m$ 个 $1$ 组成的不同 $01$ 序列数量。</p>
<p>这种问题就被称为格线游走的最基本形式，在这个上面有很多种拓展方法，如在其中加入障碍后询问方案数之类的，今天我们讨论其中一种拓展。</p>
<h1 id="伟大的思想"><a href="#伟大的思想" class="headerlink" title="伟大的思想"></a>伟大的思想</h1><img src="https://cdnjson.com/images/2023/03/20/2.png" alt="图2.png" style="zoom: 67%;" />

<p>如图，我们增添了一条直线 $y&#x3D;x+b$，我们不希望碰到这条直线，那么现在的方案数是多少？</p>
<p>对此，我们想办法减掉<strong>经过直线后再到达终点的方案</strong>，我们可以得到点 $(n,m)$ 关于 $y&#x3D;x+b$ 对称得到的点坐标为 $(m-b,n+b)$，那么我们说，每一个从 $(0,0)$ 到 $(m-b,n+b)$ 的方案都<strong>唯一对应</strong>了一个从 $(0,0)$ 先经过直线再到达终点的方案。</p>
<p>构造唯一对应的方法为，当<strong>第一次</strong>碰到直线时，将后面的路径对称得到原方案，显然方案之间两两不同。</p>
<img src="https://cdnjson.com/images/2023/03/20/356341859adf62d5b.png" alt="图3.png" style="zoom:67%;" />

<p>记 $p(n,m)&#x3D;{n+m\choose n}$，表示 $(0,0)$ 到 $(n,m)$ 的路径数量，那么此时的答案就为 $p(n,m)-p(m-b,n+b)$。</p>
<h1 id="两条直线"><a href="#两条直线" class="headerlink" title="两条直线"></a>两条直线</h1><p>接下来我们考虑两条直线的情况：$y&#x3D;x+b$ 与 $y&#x3D;x+c$（$b&gt;c$）</p>
<p>如果两条直线都在起点和终点的同一侧，即 $\min(m-n,0)&gt;\max(b,c)$ 或 $\max(m-n,0)&lt;\min(b,c)$，此时退化成了一条直线的情况。</p>
<p>我们考虑两条直线把起点和终点卡在中间的情况，即下图。</p>
<img src="https://cdnjson.com/images/2023/03/20/4.png" alt="图4.png" style="zoom: 50%;" />

<p>那么我们还是利用容斥的思想：总方案数 $&#x3D;$ 原方案数 $-$ 只经过 $y&#x3D;x+b$ 的方案数 $-$ 只经过 $y&#x3D;x+c$ 的方案数 $+$ 两条直线都经过的方案数。</p>
<p>这个式子是对的吗？是对的。但是想想怎么求两条直线都经过的方案数？</p>
<p>我们还是考虑通过翻折使之一一映射一个方案，对于一个先经过 $y&#x3D;x+b$ 再经过 $y&#x3D;x+c$ 再到达终点的方案：</p>
<img src="https://cdnjson.com/images/2023/03/20/5.png" alt="图5.png" style="zoom:50%;" />

<p>我们在第一次经过 $y&#x3D;x+b$ 时翻折，再对第一次经过 $y&#x3D;x+c$ 时按 $y&#x3D;x+c$ 关于 $y&#x3D;x+b$ 对称后的直线（也就是 $y&#x3D;x+(2b-c)$）翻折：</p>
<img src="https://cdnjson.com/images/2023/03/20/6.png" alt="图6.png" style="zoom:50%;" />

<p>可以说明此时从 $(0,0)$ 走到翻折后最终的点 $(n’,m’)$ 的方案一一对应了一个先走到 $y&#x3D;x+b$ 再走到 $y&#x3D;x+c$ 的方案。</p>
<p>然而还有先经过 $y&#x3D;x+c$ 再经过 $y&#x3D;x+b$ 的方案，先经过 $y&#x3D;x+b$ 再经过 $y&#x3D;x+c$ 再经过 $y&#x3D;x+b$ 的路线……问题变的棘手。</p>
<h1 id="反射容斥"><a href="#反射容斥" class="headerlink" title="反射容斥"></a>反射容斥</h1><p>我们需要对所有的经过直线顺序的情况进行容斥。记反射序列形如 $bcb…$ 表示格线游走依次按顺序经过直线 $y&#x3D;x+b,y&#x3D;x+c,y&#x3D;x+b,…$ 的方案，考虑我们怎么对这种依次经过直线的方案容斥的。</p>
<p>每当我们第一次到达直线时，将所对应的点和直线翻折，类比下来，那么我们可以依次对经过的直线顺序翻折，最终翻折所得到终点的方案数就是以反射序列到达原终点的方案数。</p>
<p>我们观察反射序列的形式，<strong>发现一定是由</strong> $b,c$ <strong>依次交替组成的</strong>，因为我们只在碰到 $b$ 后的下一次碰到 $c$ 才翻折，或碰到 $c$ 的下一次碰到 $b$ 后才翻折，如果连续经过了 $b$ 或 $c$，可以发现我们没有对于这种情况翻折。 </p>
<p>综上，我们可以把最终答案以容斥写成了这样一个形式：总方案 $-b-c+bc+cb-bcb-cbc+…$</p>
<p>我们考虑这样的项一共有多少个。由于每次反射后都有偏移，且因为 $b,c$ 交替反射，所以终点总是在往负半轴跑，当跑到非第一象限的区域时方案数为 $0$，因此之后就不用计算，最终时间复杂度为 $\mathcal{O}(\dfrac{n+m}{b-c})$。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>我们可以将所有反射序列看作两组：$bcbc…$ 与 $cbcb…$，我们可以同时维护这两组。</p>
<p>我们考虑需要实时维护什么：两条直线的截距，反射后的终点位置，那么我们可以记录 $b,c$ 分别表示两条直线截距，$(x,y)$ 表示终点坐标。</p>
<p>枚举反射次数，我们就能知道当前轮是 $b$ 关于 $c$ 对称还是 $c$ 关于 $b$ 对称，终点关于 $b$ 对称还是关于 $c$ 对称，然后就能求出下一轮。</p>

            <div id="vcomments"></div>
        </div>

        <div id = "toc">
        </div>

        <script>
            new Valine({
                el: '#vcomments',
                appId: 'CEGJD6I3uLgJeTF6fPsqgGmw-gzGzoHsz',
                appKey: 'R3wowhGv7IL3peB3tT06CjzS',
                visitor: true,
                master: '28a6ec927125219298a15dcb5c104f67'
            })
        </script>

    

</div>

</body>