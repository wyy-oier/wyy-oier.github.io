<head>
    <title> P2282 [HNOI2003]历史年份 - WyyOIer </title>
  	<link rel="stylesheet" href="/css/main.css">
  	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script type = "text/javascript" async src="/javascript/main.js"></script>
    <script id="MathJax-script" async src="/javascript/math/tex-mml-chtml.js"></script>
    <script src="/javascript/jquery-3.6.0.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>


   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeBlockFuction.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeCopy.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/clipboard.min.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeShrink.js"></script> -->
   <!-- <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style> -->

    <!-- <link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css"> -->
    
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <script id="Valine" src='https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js'></script>
<meta name="generator" content="Hexo 6.2.0"><link rel="stylesheet" href="/css/prism-sh.css" type="text/css"></head>

<body>


<div id = "background">
    <div id = "index">
        <div id="menu">

    <div style="text-align: center;font-size: 32px;font-family: consolas;">
        <p>WyyOIer</p>
    </div>

    <div style="height: 150px;float: up;display: flex;flex-direction: column;align-items: center;">
        <div id="headstyle">
            
        </div>
    </div>
	
    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "pcount" title = "文章数" style = "font-family: consolas;font-size: 20px;">23</text>
    </div>

    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "commentcount" title = "评论数" style = "font-family: consolas;font-size: 20px;">0</text>
    </div>

    <div style="height: 50px;width: 40%;float: left;text-align: center;">
        <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/159610">
        <img src="https://www.luogu.com.cn/favicon.ico" alt="洛谷" width="24" height="24"></a>
        &nbsp; 
        <a target="_blank" rel="noopener" href="https://codeforces.com/profile/WyyOIer">
        <img src="https://codeforces.com/favicon.ico" alt="CF" width="24" height="24"></a>
    </div>


    <div class="list-group">
        <a class="list-group-item" href="/"><i class="fa fa-home fa-fw"></i>&nbsp; 首页</a>
        <a class="list-group-item" href="/about"><i class="fa fa-user fa-fw"></i>&nbsp; 关于</a>
        <a class="list-group-item" href="/links"><i class="fa fa-link fa-fw"></i>&nbsp; 友链</a>
        <a class="list-group-item" onclick = "Search()"><i class="fa fa-search fa-fw"></i>&nbsp; 搜索</a>
        <a class="list-group-item" href="/source"><i class="fa fa-code fa-fw"></i>&nbsp; 代码</a>
        <a class="list-group-item" href="/config"><i class="fa fa-cog fa-fw"></i>&nbsp; 设置</a>
    </div>

    <script>
        function changemusicid(){
            var v = document.getElementById("num").value, text, f = 0;
            if(v == null || v == "") {
            text = "输入不能为空。";
            f = 1;
            }
            if(f == 0) document.getElementById("music").innerHTML= '<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=250 height=95 src="//music.163.com/outchain/player?type=2&id=' + v + '&auto=0&height=66"></iframe> ';
            else document.getElementById("musictext").innerHTML = text;
        }
    </script>

    <div style="height: 13%;width: 30%;float: left" id="music">
    <!-- <input id = "num" placeholder = "输入网易音乐 id，如 480517594" style = "width: 230px;"> -->
    <!-- <button type="button" onclick="changemusicid()">提交</button> -->
    <!-- <p id = "musictext"></p> -->
    </div>

</div>


    </div>

    

    


    

        <div id = "article">
            <div id = "post-title"> P2282 [HNOI2003]历史年份 </div>
            <div id = "post-author"> By WyyOIer | </div>
            <div id = "post-date" title = "发布时间"> 2022-08-06 15:01:41 / </div>
            <div id = "post-updated" title = "更新时间"> 2022-08-06 15:49:04 </div>
            <span class = "leancloud_visitors" id = "/2022/08/06/P2282-HNOI2003-%E5%8E%86%E5%8F%B2%E5%B9%B4%E4%BB%BD/">
                <text class="post-meta-item-text">阅读数 </text>
                <i class="leancloud-visitors-count">nan</i>
            </span>
            <br>
            <h1 id="暴力"><a href="#暴力" class="headerlink" title="暴力"></a>暴力</h1><p>先来看看朴素 dp 的转移。</p>
<p>记 $num(i,j)$ 表示 $[i,j]$ 表示的具体数值。</p>
<p>设 $f_i$ 表示划分 $[1,i]$ 最后一段的左端点的最大值。因为如果想要使最后一段最小，那么最后一段的上一段也要尽量小，因为越小限制就越小，答案就可能更优。</p>
<p>转移为：$f_i&#x3D;\max(j)$，其中 $1\le j&lt;i,num(f_j,j)&lt;(j+1,i)$。</p>
<p>设 $g_i$ 表示划分 $[i,n]$，<strong>保证最后一段最优的情况下</strong>，最前一段右端点的最大值。这个是为了保证最后一个数最小的情况下字典序最大的操作，这样我们就完美的处理了题目的要求。</p>
<p>转移为：$g_i&#x3D;max(j)$，其中 $i&lt;j\le n,num(i,j-1)&lt;num(j,g_j)$。</p>
<p>最后从 $g_1$ 往后输出得到答案，时间复杂度 $\mathcal{O}(n^3)$。</p>
<h1 id="优化-1"><a href="#优化-1" class="headerlink" title="优化 $1$"></a>优化 $1$</h1><p>考虑在比对 $num$ 的时候用二分哈希维护，复杂度降至 $O(n^2\log n)$。</p>
<p>注意需要维护 $l_i,r_i$ 表示位置 $i$ 左右第一个不为 $0$ 的位置，因为不能带着前导 $0$ 比较。</p>
<h1 id="优化-2"><a href="#优化-2" class="headerlink" title="优化 $2$"></a>优化 $2$</h1><p>我们考虑如何快速的求出 $f$ ，会发现由于前导 $j$ 和 $f_j$ 的不确定性，<del>没有前途</del>无法继续进行优化。</p>
<p>基于此，我们尝试将“人人为我”改为“我为人人”，这样的一大好处是，当我枚举到 $i$ 的时候，已经算出了 $f_i$，在 $f_i$ 和 $i$ 确定的情况下，找到一个 $p$ 使得 $num(f_i,i)&lt;num(i+1,p)$ 是十分容易的，然后我们将 $[p+1,n]$ 在线段树上打标记，最后查询最大值即可，而 $g$ 的求法也同理。这样二分哈希有一个 log，线段树有一个 log，但因为这两个 log 不嵌套，所以复杂度为 $\mathcal{O}(n\log n)$。<del>常数巨大</del></p>
<p>一些注意事项：</p>
<ul>
<li>关于 $p$ 的求法：观察得到，设 $num(f_i,i)$ 的数值长度为 $q$，将前导 $0$ 去掉后的初始位置为 $st$，那么符号要求 $p$ 只会是 $st+q-1$ 或 $st+q$，所以只用二分哈希一次就能找到 $p$。$g$ 稍微麻烦一点但同理，可以自行思考。</li>
<li>线段树采用标记永久化的方法（修改的时候在对应的位置打 tag 但不 pushdown，query 的时候把路上所有答案取最大值），节约常数。</li>
<li>在求 $g$ 之前，将 $[l_{f_n-1}+1,n]$ 先都设为 $n$，表示将最后一段和最后一段之前的前导 $0$ 都设为最后一段最优的情况，求 $g$ 的时候从 $f_n$ 开始向前更新。</li>
<li>注意一些特殊情况（比如开始全 $0$ 的时候我的程序会死循环，有些下标取最大值的地方需要思考）</li>
</ul>

            <div id="vcomments"></div>
        </div>

        <div id = "toc">
        </div>

        <script>
            new Valine({
                el: '#vcomments',
                appId: 'CEGJD6I3uLgJeTF6fPsqgGmw-gzGzoHsz',
                appKey: 'R3wowhGv7IL3peB3tT06CjzS',
                visitor: true,
                master: '28a6ec927125219298a15dcb5c104f67'
            })
        </script>

    

</div>

</body>