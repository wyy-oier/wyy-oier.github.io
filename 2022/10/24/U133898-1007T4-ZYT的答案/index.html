<head>
    <title> U133898 [1007T4]ZYT的答案 - WyyOIer </title><meta name="robots" content="noindex">
  	<link rel="stylesheet" href="/css/main.css">
  	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script type = "text/javascript" async src="/javascript/main.js"></script>
    <script id="MathJax-script" async src="/javascript/math/tex-mml-chtml.js"></script>
    <script src="/javascript/jquery-3.6.0.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>


   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeBlockFuction.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeCopy.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/clipboard.min.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeShrink.js"></script> -->
   <!-- <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style> -->

    <!-- <link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css"> -->
    
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <script id="Valine" src='https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js'></script>
<meta name="generator" content="Hexo 6.2.0"><link rel="stylesheet" href="/css/prism-sh.css" type="text/css"></head>

<body>


<div id = "background">
    <div id = "index">
        <div id="menu">

    <div style="text-align: center;font-size: 32px;font-family: consolas;">
        <p>WyyOIer</p>
    </div>

    <div style="height: 150px;float: up;display: flex;flex-direction: column;align-items: center;">
        <div id="headstyle">
            
        </div>
    </div>
	
    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "pcount" title = "文章数" style = "font-family: consolas;font-size: 20px;">22</text>
    </div>

    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "commentcount" title = "评论数" style = "font-family: consolas;font-size: 20px;">0</text>
    </div>

    <div style="height: 50px;width: 40%;float: left;text-align: center;">
        <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/159610">
        <img src="https://www.luogu.com.cn/favicon.ico" alt="洛谷" width="24" height="24"></a>
        &nbsp; 
        <a target="_blank" rel="noopener" href="https://codeforces.com/profile/WyyOIer">
        <img src="https://codeforces.com/favicon.ico" alt="CF" width="24" height="24"></a>
    </div>


    <div class="list-group">
        <a class="list-group-item" href="/"><i class="fa fa-home fa-fw"></i>&nbsp; 首页</a>
        <a class="list-group-item" href="/about"><i class="fa fa-user fa-fw"></i>&nbsp; 关于</a>
        <a class="list-group-item" href="/links"><i class="fa fa-link fa-fw"></i>&nbsp; 友链</a>
        <a class="list-group-item" onclick = "Search()"><i class="fa fa-search fa-fw"></i>&nbsp; 搜索</a>
        <a class="list-group-item" href="/source"><i class="fa fa-code fa-fw"></i>&nbsp; 代码</a>
        <a class="list-group-item" href="/config"><i class="fa fa-cog fa-fw"></i>&nbsp; 设置</a>
    </div>

    <script>
        function changemusicid(){
            var v = document.getElementById("num").value, text, f = 0;
            if(v == null || v == "") {
            text = "输入不能为空。";
            f = 1;
            }
            if(f == 0) document.getElementById("music").innerHTML= '<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=250 height=95 src="//music.163.com/outchain/player?type=2&id=' + v + '&auto=0&height=66"></iframe> ';
            else document.getElementById("musictext").innerHTML = text;
        }
    </script>

    <div style="height: 13%;width: 30%;float: left" id="music">
    <!-- <input id = "num" placeholder = "输入网易音乐 id，如 480517594" style = "width: 230px;"> -->
    <!-- <button type="button" onclick="changemusicid()">提交</button> -->
    <!-- <p id = "musictext"></p> -->
    </div>

</div>


    </div>

    

    


    

        <div id = "article">
            <div id = "post-title"> U133898 [1007T4]ZYT的答案 </div>
            <div id = "post-author"> By WyyOIer | </div>
            <div id = "post-date" title = "发布时间"> 2022-10-24 18:03:21 / </div>
            <div id = "post-updated" title = "更新时间"> 2022-11-20 08:35:55 </div>
            <span class = "leancloud_visitors" id = "/2022/10/24/U133898-1007T4-ZYT%E7%9A%84%E7%AD%94%E6%A1%88/">
                <text class="post-meta-item-text">阅读数 </text>
                <i class="leancloud-visitors-count">nan</i>
            </span>
            <br>
            <p>考虑到什么情况下一份答案会作出贡献。当且仅当这个人的路径先经过钥匙，再经过答案才有贡献。</p>
<p>我们可以维护一颗线段树，表示以每个点为起点的路径上能拿到的答案作出的贡献，然后我们按 dfn 序扫描当前的终点，然后动态更新线段树上每一段的贡献。接下来我们考虑具体如何贡献。</p>
<p>我将每一个答案 $y$ 和钥匙 $x$ 分为四类：</p>
<ol>
<li>不为祖先关系，把 $y$ 打到 $x$ 的 $\text{vecotor}$ 中，记作 $li$。</li>
<li>答案是钥匙的祖先，把 $y$ 打到 $y$ 到 $x$ 的路径上的 $x$ 的儿子的 $\text{vector}$ 中，记作 $down$。</li>
<li>钥匙是答案的祖先，把 $y$ 打到 $x$ 的路径上的 $\text{vector}$ 中，记作 $up$。</li>
<li>答案和钥匙在同一个节点上，我们记一个 $ww$ 数组，每次将答案贡献加在点上。</li>
</ol>
<p>分好这四类后，我们从 $1$ 号点开始，考虑开始时的贡献。</p>
<p>对于某个 $4$ 类点 $u_4$，如果起点在 $u_4$ 的子树内，则存在贡献，所以我们在最开始要将每个 $u_4$ 的子树对应的区间加 $ww_{u_4}$。</p>
<p>对于所有 $2$ 类的答案 $x_2$，如果起点在 $x_2$ 的子树内，则存在贡献，将 $x_2$ 的子树对应的区间加上这个答案的贡献。</p>
<p>其余情况在以 $1$ 号点为终点时均无贡献，所以我们已经考虑完了初始情况。</p>
<p>接下来我们对于 dfs 的一般情况，考虑对于当前的节点 $u$，当 $u$ 走到 $u$ 的子树内与从 $u$ 走出 $u$ 的子树内的贡献变化情况。</p>
<p>当我们第一次到达 $u$ 时，</p>
<p>对于所有在 $u$ 的 $1$ 类答案，钥匙所对应的节点为 $y_1$，如果起点在 $y_1$ 的子树内，我们可以保证在刚到达 $u$ 是刚刚作出贡献，且在 $u$ 的子树内贡献不变。</p>
<p>对于 $2$ 类答案，由于 $\text{vector}$ 中存的是答案的儿子，那么当我们第一次走到了答案上的儿子，也就是开始遍历答案的儿子的子树上时，这份答案恰好刚刚开始不作出贡献，我们要把以钥匙为根的子树的贡献减掉。</p>
<p>对于所有在 $u$ 的 $3$ 类答案，我们发现在以钥匙的儿子的这个子树内为起点的时候，都不会作出贡献，在儿子的子树外的任何地方，都可以做出贡献。</p>
<p>对于所有 $4$ 类答案，这里我们只需要把这个答案之外的部分补一下贡献即可，但我们还要把 $u$ 的子树减掉父亲的贡献，代表在 $u$ 的子树的起点无法以 $u$ 为终点的路径拿到 $fa$ 节点的钥匙和答案。</p>
<p>对于走出 $u$ 的子树的贡献，我们把上述贡献全部反过来即可，这样就用 $\mathcal{O}(n\log n)$ 的复杂度完美通过。</p>
<!-- flag of hidden posts -->
            <div id="vcomments"></div>
        </div>

        <div id = "toc">
        </div>

        <script>
            new Valine({
                el: '#vcomments',
                appId: 'CEGJD6I3uLgJeTF6fPsqgGmw-gzGzoHsz',
                appKey: 'R3wowhGv7IL3peB3tT06CjzS',
                visitor: true,
                master: '28a6ec927125219298a15dcb5c104f67'
            })
        </script>

    

</div>

</body>