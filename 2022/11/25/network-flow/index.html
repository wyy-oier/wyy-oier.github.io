<head>
    <title> 网络流算法 - WyyOIer </title>
  	<link rel="stylesheet" href="/css/main.css">
  	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script type = "text/javascript" async src="/javascript/main.js"></script>
    <script id="MathJax-script" async src="/javascript/math/tex-mml-chtml.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>


   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeBlockFuction.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeCopy.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/clipboard.min.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeShrink.js"></script> -->
   <!-- <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style> -->

    <!-- <link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css"> -->
    
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <script id="Valine" src='https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js'></script>
<meta name="generator" content="Hexo 6.2.0"><link rel="stylesheet" href="/css/prism-sh.css" type="text/css"></head>

<body>


<div id = "background">
    <div id = "index">
        <div id="menu">

    <div style="text-align: center;font-size: 32px;font-family: consolas;">
        <p>WyyOIer</p>
    </div>

    <div style="height: 150px;float: up;display: flex;flex-direction: column;align-items: center;">
        <div id="headstyle">
            
        </div>
    </div>
	
    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "pcount" title = "文章数" style = "font-family: consolas;font-size: 20px;">21</text>
    </div>

    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "commentcount" title = "评论数" style = "font-family: consolas;font-size: 20px;">0</text>
    </div>

    <div style="height: 50px;width: 40%;float: left;text-align: center;">
        <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/159610">
        <img src="https://www.luogu.com.cn/favicon.ico" alt="洛谷" width="24" height="24"></a>
        &nbsp; 
        <a target="_blank" rel="noopener" href="https://codeforces.com/profile/WyyOIer">
        <img src="https://codeforces.com/favicon.ico" alt="CF" width="24" height="24"></a>
    </div>


    <div class="list-group">
        <a class="list-group-item" href="/"><i class="fa fa-home fa-fw"></i>&nbsp; 首页</a>
        <a class="list-group-item" href="/about"><i class="fa fa-user fa-fw"></i>&nbsp; 关于</a>
        <a class="list-group-item" href="/links"><i class="fa fa-link fa-fw"></i>&nbsp; 友链</a>
        <a class="list-group-item" onclick = "Search()"><i class="fa fa-search fa-fw"></i>&nbsp; 搜索</a>
        <a class="list-group-item" href="/source"><i class="fa fa-code fa-fw"></i>&nbsp; 代码</a>
        <a class="list-group-item" href="/config"><i class="fa fa-cog fa-fw"></i>&nbsp; 设置</a>
    </div>

    <script>
        function changemusicid(){
            var v = document.getElementById("num").value, text, f = 0;
            if(v == null || v == "") {
            text = "输入不能为空。";
            f = 1;
            }
            if(f == 0) document.getElementById("music").innerHTML= '<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=250 height=95 src="//music.163.com/outchain/player?type=2&id=' + v + '&auto=0&height=66"></iframe> ';
            else document.getElementById("musictext").innerHTML = text;
        }
    </script>

    <div style="height: 13%;width: 30%;float: left" id="music">
    <!-- <input id = "num" placeholder = "输入网易音乐 id，如 480517594" style = "width: 230px;"> -->
    <!-- <button type="button" onclick="changemusicid()">提交</button> -->
    <!-- <p id = "musictext"></p> -->
    </div>

</div>


    </div>

    

    


    

        <div id = "article">
            <div id = "post-title"> 网络流算法 </div>
            <div id = "post-author"> By WyyOIer | </div>
            <div id = "post-date" title = "发布时间"> 2022-11-25 16:06:46 / </div>
            <div id = "post-updated" title = "更新时间"> 2023-02-01 21:31:53 </div>
            <span class = "leancloud_visitors" id = "/2022/11/25/network-flow/">
                <text class="post-meta-item-text">阅读数 </text>
                <i class="leancloud-visitors-count">nan</i>
            </span>
            <br>
            <h1 id="流网络-text-Flow-Network"><a href="#流网络-text-Flow-Network" class="headerlink" title="流网络 $\text{(Flow Network)}$"></a>流网络 $\text{(Flow Network)}$</h1><p>对于一个有向图 $G&#x3D;(V,E)$，$\forall(u,v)\in E$，有一个权值 $c(u,v)$，代表 $u\rightarrow v$ 这条边的流量 $\text{(capacity)}$，当 $(u,v)\notin E$ 时有 $c(u,v)&#x3D;0$。</p>
<p>在这个有向图中，存在 $s\in V,t\in V$，我们称之为源点 $\text{(source)}$ 和汇点 $\text{(sink)}$，且 $s\neq t$ 。</p>
<p>我们把这样的图称之为网络。</p>
<h1 id="可行流-text-Flow"><a href="#可行流-text-Flow" class="headerlink" title="可行流 $\text{(Flow)}$"></a>可行流 $\text{(Flow)}$</h1><p>$\forall u\in V,v\in V$，定义函数 $f(u,v)$ 为 $u\rightarrow v$ 的流量，$c’(u,v)&#x3D;c(u,v)-f(u,v)\ge 0$ 称为 $u\rightarrow v$ 的剩余容量。此时不考虑反向边会比较好。</p>
<p>我们定义可行流函数 $f(u,v)$ 满足如下性质：</p>
<ol>
<li>$\forall(u,v)\in E,f(u,v)\le c(u,v)$，任意一条边的流量不超过这条边的容量。</li>
<li>$\forall x\in V,x\neq s,t,\sum\limits_{(u,x)\in E}f(u,x)&#x3D;\sum\limits_{(x,v)\in E}f(x,v)$，即任意一个点，进入这个点的流量都等于出去的流量。</li>
</ol>
<p>一个网络的流就是源点发出的全部流量，记 $F&#x3D;\sum\limits_{\forall(s,u)\in E}f(s,u)$。</p>
<h1 id="残留网络"><a href="#残留网络" class="headerlink" title="残留网络"></a>残留网络</h1><p>残留网络的点集和边集与原网络是一样的，但唯一不同的是每条边存在一个<strong>剩余容量</strong>，这里我们对于一个有向边，考虑其的<strong>反向边</strong>：</p>
<ul>
<li>当 $(u,v)\in E$，$c’(u,v)&#x3D;c(u,v)-f(u,v),c’(v,u)&#x3D;f(u,v)$。</li>
</ul>
<p>反向边的加入是为了存在反悔贪心的操作，保证了算法正确性，在程序中我们所建的都是残留网络。</p>
<h1 id="增广路"><a href="#增广路" class="headerlink" title="增广路"></a>增广路</h1><p>对于一条从 $s$ 到 $t$ 的路径，对于路径上任意一条边 $(u,v)$，满足 $c’(u,v)&gt;0$，我们就称这条路径为增广路。</p>
<p>那么如果有了一条增广路，我们就会尝试让源点分一点流量给这条增广路，而分配的流量就是每条边剩余容量的最小值（显然多了也流不过去），不难发现，当网络中存在增广路，则最大流答案将变大。</p>
<h1 id="割"><a href="#割" class="headerlink" title="割"></a>割</h1><p>如果有网络 $G&#x3D;(V,E)$，存在集合 $S,T\subseteq V,S\cap T&#x3D;\emptyset,S\cup T&#x3D;V,s\in S,t\in T$，则称 $S,T$ 是对于网络 $G$ 的一个割。</p>
<h2 id="割的容量"><a href="#割的容量" class="headerlink" title="割的容量"></a>割的容量</h2><p>对于一个割 $S,T$，$c(S,T)&#x3D;\sum\limits_{u\in S,v\in T,(u,v)\in E}c(u,v)$，我们称之为割的容量。</p>
<h2 id="最小割"><a href="#最小割" class="headerlink" title="最小割"></a>最小割</h2><p>最小割的指的是割的最小<strong>容量</strong>。</p>
<h2 id="割的流量"><a href="#割的流量" class="headerlink" title="割的流量"></a>割的流量</h2><p>对于一个割 $S,T$，$f(S,T)&#x3D;\sum\limits_{u\in S,v\in T, (u,v)\in E}f(u,v)-\sum\limits_{u\in S,v\in T,(u,v)\in E}f(v,u)$，我们称之为割的容量。</p>
<p>意思为从 $S$ 中的点流到 $T$ 中的点的流量减去从 $T$ 的点流回到 $S$ 的点的流量。</p>
<h2 id="割的性质"><a href="#割的性质" class="headerlink" title="割的性质"></a>割的性质</h2><ol>
<li><p>$f(X,Y)+f(Y,X)&#x3D;0$</p>
</li>
<li><p>$f(X,X)&#x3D;0$</p>
</li>
<li><p>$f(Z,X\cup Y)&#x3D;f(Z,X)+f(Z,Y)$</p>
</li>
<li><p>$f(X\cup Y,Z)&#x3D;f(X,Z)+f(Y,Z)$</p>
</li>
<li><p>$\forall [S,T],\forall f,f(S,T)\le c(S,T)$。即任意的一个割与原网络的任意一个可行流，有割的流量不超过割的容量。</p>
</li>
<li><p>$f(S,T)&#x3D;F$，即割的流量等于原网络的可行流。</p>
<blockquote>
<p>证明：</p>
<p>$\because f(S,V)&#x3D;f(S,S)+f(S,T)$（性质 $3$）且 $f(S,S)&#x3D;0$（性质 $2$）</p>
<p>$\therefore f(S,V)&#x3D;f(S,T)$</p>
<p>又 $\because f(S,V)&#x3D;f({s},V)+f(S\backslash{s},V)$ （性质 $4$）</p>
<p>记 $S’&#x3D;S\backslash {s}$，$S’$ 中不存在源点和汇点，则流量守恒，有 $f(S’,V)&#x3D;0$</p>
<p>$\therefore f(S,T)&#x3D;f({s},V)&#x3D;F$</p>
</blockquote>
</li>
<li><p>$F\le c(S,T)$，由性质 $5,6$ 可得。则我们能得到<strong>最大流不超过最小割</strong>。</p>
</li>
</ol>
<h1 id="最大流"><a href="#最大流" class="headerlink" title="最大流"></a>最大流</h1><p>对于一个在网络的所有可行流，所得到的最大的 $F$ 称为网络的最大流，记作 $F_{\max}$。</p>
<p>最大流指的是最大可行流。</p>
<h1 id="最大流最小割定理"><a href="#最大流最小割定理" class="headerlink" title="*最大流最小割定理"></a>*最大流最小割定理</h1><p>最大流最小割定理指的是这样 $3$ 个条件互相等价：</p>
<p>$\text{A.}$ 原网络取到最大流 $F_{\max}$</p>
<p>$\text{B.}$ 残留网络中不存在增广路</p>
<p>$\text{C.}$ 存在 $[S,T],c(S,T)&#x3D;F$</p>
<blockquote>
<p>证明：</p>
<p>$\mathcal{I.}\text{A}\Rightarrow \text{B}$</p>
<p>若当原网络取到最大流 $F_{\max}$ 时，残留网络仍存在增广路。</p>
<p>那么我可以通过增广这条增广路的方式增加原网络流量使其不是最大流。</p>
<p>证毕。</p>
<p>$\mathcal{II.}\text{B}\Rightarrow\text{C}$</p>
<p>由于只需存在一个割满足，那么考虑一种构造方式：</p>
<p>对于当前的残留网络，$S$ 集合为源点 $s$ 通过剩余容量不为 $0$ 的边可到达的点集，$T$ 为 $V\backslash S$。</p>
<p>由于 $\text{B}$ 条件，所以 $S$ 集合一定不包含 $t$。</p>
<p>考虑此时的 $c(S,T)$。</p>
<p>$\forall u\in S,v\in T$，我们有 $f(u,v)&#x3D;c(u,v)$。如果 $f(u,v)&lt; c(u,v)$，那么在残留网络中这条边的剩余流量 $c’(u,v)&#x3D;c(u,v)-f(u,v)&gt;0$，则 $v$ 应该也在 $S$ 中矛盾。</p>
<p>$\forall u\in S, v\in T$，我们有 $f(v,u)&#x3D;0$，证明方式同上。</p>
<p>那么我们有 $f(S,T)&#x3D;\sum\limits_{u\in S,v\in T, (u,v)\in E}f(u,v)-\sum\limits_{u\in S,v\in T,(u,v)\in E}f(v,u)&#x3D;\sum\limits_{u\in S,v\in T,(u,v)\in E}c(u,v)&#x3D;c(S,T)$</p>
<p>又有 $f(S,T)&#x3D;F$，$\therefore c(S,T)&#x3D;F$，证毕。</p>
<p>$\mathcal{III.}\text{C}\Rightarrow A$</p>
<p>原命题 $\Leftrightarrow$ $F&#x3D;c(S,T)&#x3D;F_{\max}$</p>
<p>由性质 $7$，最大流小于等于最小割。</p>
<p>最小割 $\le c(S,T)&#x3D;F\le F_{\max}$</p>
<p>所以最小割小于等于最大流，所以<strong>最小割等于最大流</strong>，同时得到 $F$ 就是最大流。</p>
<p>证毕。</p>
</blockquote>
<p>那么我们就得到了，残留网络中没有增广路和当前的流是最大流是充要条件。</p>
<h1 id="最大流算法"><a href="#最大流算法" class="headerlink" title="最大流算法"></a>最大流算法</h1><h2 id="text-Edmonds-Karp"><a href="#text-Edmonds-Karp" class="headerlink" title="$\text{Edmonds Karp}$"></a>$\text{Edmonds Karp}$</h2><p>网络最大流是怎么求的呢？有了对于增广路的概念，我们不难想到一个较为朴素的做法：在当前残留网络中，找到一条增广路，如果能找到增广路，说明当前的流的答案会变大，增加流，然后把增广路上的每条边的容量减掉增广路上所有边的最小容量，重复过程直到不能找到增广路。</p>
<p>乍一看十分之正确，但是存在一个问题：对于这样的一个贪心模拟的过程是否存在着后效性？</p>
<p>答案是有可能的，比如有 $s\rightarrow 1\rightarrow 2\rightarrow t,s\rightarrow1\rightarrow3\rightarrow t,s\rightarrow3\rightarrow t$ 这 $3$ 条增广路，如果我们恰好先选了 $s\rightarrow1\rightarrow3\rightarrow t$ 这条，然后恰好增广后 $c’(3,t)$ 变为 $0$，那不就增广不到 $s\rightarrow3\rightarrow t$ 了，但是显然我们还有增广 $s\rightarrow 1\rightarrow 2\rightarrow t,s\rightarrow3\rightarrow t$ 这两条路径的选择，那怎么处理这种情况呢？</p>
<p>问题的本质是存在后效性，那么能不能想办法采用类似<strong>反悔贪心</strong>的做法来做？</p>
<p><strong>考虑为每条边开一个反向边</strong>。初始时反向边容量设为 $0$。</p>
<p>在我们增广了一次之后，将增广的路径上的正向边减少容量，反向边增加容量，这样上面的情况就会被反悔出来。</p>
<p>由于最大流最小割定理，所以只要残留网络中没有增广路，则一定得到最大流。</p>
<p>实现十分的容易，就是扫整张网络找增广路，并修改路径上的容量。</p>
<h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>理论证明的复杂度为 $\mathcal{O}(nm^2)$，但远远不能达到此上界，可处理 $n\le 10^4$ 的网络。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1005</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
<span class="token keyword">int</span> flow<span class="token punctuation">;</span>
<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> pre<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> vis<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>vis<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> vis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>incf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> incf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> vis<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                pre<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                incf<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>incf<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> t <span class="token operator">=</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        flow <span class="token operator">+</span><span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> T<span class="token punctuation">;</span> u <span class="token operator">!=</span> S<span class="token punctuation">;</span> u <span class="token operator">=</span> e<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> t<span class="token punctuation">,</span> f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> S <span class="token operator">>></span> T<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>m<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> c<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> u <span class="token operator">>></span> v <span class="token operator">>></span> c<span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> flow <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="text-Dinic"><a href="#text-Dinic" class="headerlink" title="$\text{Dinic}$"></a>$\text{Dinic}$</h2><p>$\text{Dinic}$ 的主要思想也是增广，但是不同于 EK 的每次增广一条路径，$\text{Dinic}$ 可以增广多条路径。</p>
<p>那么我们就要用 <code>dfs()</code> 找增广路了，但在找增广路前，首先需要用 <code>bfs()</code> 做一些准备工作，具体就是标注 $dis_u$ 表示 $s\rightarrow u$ 的最短路径长度，当然这里指的是增广路路径长度，<del>要不然跑就不用跑那么多遍</del>。</p>
<p>这样我们实际是给<strong>网络标了一个 DAG 序</strong>，使 <code>dfs()</code> 不会进入死循环，而其特有的<strong>回溯</strong>功能可使我们遍历到多条增广路。</p>
<p>那么算法流程是：先用 <code>bfs()</code> 分层，然后 <code>dfs(u, Flow)</code> 表示走到了 $u$ 点，从 $s\rightarrow u$ 的最小的一条边的容量是 $Flow$，每次我们找一个 $v$，使得 $dep_v&#x3D;dep_u+1$，然后在途中就去更新正向边和反向边。</p>
<h3 id="优化-1"><a href="#优化-1" class="headerlink" title="优化 $1$"></a>优化 $1$</h3><p>一个剪枝，搜的时候记录当前点的<strong>流出量</strong> $used$，显然当 $used&#x3D;Flow$ 时，给到 $u$ 点的流都被用光了，就不用继续再从 $u$ 增广了，可以直接从 $u$ 退出回溯。</p>
<h3 id="优化-2"><a href="#优化-2" class="headerlink" title="优化 $2$"></a>优化 $2$</h3><p>一个剪枝，叫做<strong>当前弧优化</strong>。</p>
<p>当我们在枚举 $u$ 的出边时，我们是按我们链式前向星存边的顺序枚举一条出边 $(u,v)$，而此时我们还有 $x_1\rightarrow u,x_2\rightarrow u,\cdots$ 这样的边。</p>
<p>当 $x_1\rightarrow u$，跑 $u$ 所有的出边找增广路。</p>
<p>当 $x_2\rightarrow u$，跑 $u$ 所有的出边找增广路。</p>
<p>当 $x_3\rightarrow u$，跑 $u$ 所有的出边找增广路。</p>
<p>$\cdots$</p>
<p>每次都重新跑了所有出边，但由于 <code>dfs()</code> 的性质可能<strong>在前面被枚举到的出边容量</strong>已经增广完了。</p>
<p>所以记录 $cur_u$ 表示当前 $u$ 的出边在 $cur_u$ 之前被枚举到的已经增广完了，我们现在从 $cur_u$ 再增广就可以了。</p>
<p>十分有用的优化。</p>
<h3 id="优化-3"><a href="#优化-3" class="headerlink" title="优化 $3$"></a>优化 $3$</h3><p>对于一条边 $u\rightarrow v$，如果从 $v$ 开始搜索得到的流已经为 $0$，那么这轮搜索中以后再到达 $v$ 的流仍然为 $0$，直接在当前轮中把 $v$ 删掉，实现可以是 $dep_v&#x3D;Inf$ 或其它。</p>
<h3 id="时间复杂度-1"><a href="#时间复杂度-1" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>理论证明的复杂度为 $\mathcal{O}(n^2m)$，但远远不能达到此上界，可处理 $n\le 10^5$ 的网络。</p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">10005</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">200005</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
<span class="token keyword">int</span> flow<span class="token punctuation">;</span>
<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dep<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> cur<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> head<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>dep<span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> dep<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> Inf <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dep<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>dep<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">!=</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">==</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> flow<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> used <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> cur<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cur<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> dep<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> flow <span class="token operator">-</span> used<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>low <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                used <span class="token operator">+</span><span class="token operator">=</span> low<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> low<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> low<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>used <span class="token operator">==</span> flow<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> used<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flow <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> S <span class="token operator">>></span> T<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>m<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> c<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> u <span class="token operator">>></span> v <span class="token operator">>></span> c<span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> flow <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="最大流相关模型和例题"><a href="#最大流相关模型和例题" class="headerlink" title="最大流相关模型和例题"></a>最大流相关模型和例题</h1><h2 id="二分图匹配"><a href="#二分图匹配" class="headerlink" title="二分图匹配"></a>二分图匹配</h2><p>二分图匹配一般指的是存在两个点集，点集内部没有边，点集之间有若干条边相连，一个匹配指的是从边集中选出一个子集，使得一个点<strong>至多</strong>出现在一条边中。</p>
<p>我们将其抽象成一个网络流模型，对于每一条边 $(u,v)$，我们在网络中连一条容量为 $1$ 的 $u\rightarrow v$ 的边，这样当这条边的流量为 $1$ 时，代表这条边被选择。</p>
<h3 id="P2756-飞行员配对方案问题"><a href="#P2756-飞行员配对方案问题" class="headerlink" title="P2756 飞行员配对方案问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2756">P2756 飞行员配对方案问题</a></h3><p>最典型的二分图匹配，我们向源点和每一个外籍飞行员连一条容量为 $1$ 的边，英国飞行员连一条容量为 $1$ 的边，然后外籍飞行员和英国飞行员之间的匹配连一条容量为 $1$ 的边。</p>
<p>我们需要先证明原问题的每一个可行解 $s$，对应一个网络中的可行流 $f$。可行流的满足条件为<strong>容量限制</strong>和<strong>流量守恒</strong>。</p>
<p>对于一个可行解 $s$ ，一个可行解满足每个人至多在一条匹配边中，这些边的流量设为 $1$，而其余匹配边的流量设为 $0$，对于所有外国籍的点，流出流量最多为 $1$；对于所有英国籍的点，流入流量最多为 $1$。我们可以用源点出边的流量和汇点入边的流量补上使其符合流量守恒，所以一个可行解必定对应一个可行流。</p>
<p>对于一个可行流 $f$ ，为了符合题意，不妨先假设每条边的流量为 $0$ 或 $1$。</p>
<p>因为满足流量守恒，所以除了源点和汇点外，每个点的流入的流量和流出的流量相等，外国籍点流入流量和英国记流出流量均最多为 $1$，则每个人要么不匹配，要么至多在一组匹配中，所以一个可行流一定是一个可行解。</p>
<p>所以现在我们证明了每个可行解 $s$ 和<strong>整数流量的</strong>可行流<strong>一一对应</strong>，那么当我们证明了只要<strong>整数流量的最大流就是全局最大流</strong>的话，那么最大流就是<strong>全局最优解</strong>。</p>
<p>这个证明比较简单：因为 $\text{Dinic}$ 算法中只用到了整数变量，且得到最大流的充要条件是残留网络中不存在增广路，那么由于 $\text{Dinic}$ 跑完后没有了增广路，所以<strong>整数流量的最大流也是所有情况的最大流</strong>。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101009585">https://www.luogu.com.cn/record/101009585</a></p>
<h3 id="P3254-圆桌问题"><a href="#P3254-圆桌问题" class="headerlink" title="P3254 圆桌问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3254">P3254 圆桌问题</a></h3><p>在这道题中，区别仅仅在于从每个点的容量限制的不同，因为一个单位有 $r_i$ 个人，我们从汇点向每个单位连一条容量为 $r_i$ 的边，一个餐桌容纳 $c_i$ 个人，我们从每个餐桌向汇点连一条容量为 $c_i$ 的边，然后因为一个单位的人最多向每个桌子之间派 $1$ 个人，所以每个单位向每个桌子连一条容量为 $1$ 的边，这样不难证明，当网络满流时即是合法方案，所以跑最大流看是不是满流即可。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101009737">https://www.luogu.com.cn/record/101009737</a></p>
<h2 id="无源汇上下界可行流"><a href="#无源汇上下界可行流" class="headerlink" title="无源汇上下界可行流"></a>无源汇上下界可行流</h2><p>给定一个无源点和汇点的网络，每条边要求的流量存在上下界，求这个网络是否存在可行流。</p>
<p>因为没有源点和汇点，所以一个可行流需要保证<strong>所有的点满足流量守恒</strong>。</p>
<p>如果本题在没有下界的情况下，在初始什么流量也没有的时候，所有点均满足流量守恒，但如果我们先给所有边流下界的流量，并不能保证所有点流量守恒，那么我们为了满足流量守恒，我们可以记录 $A_i$ 表示 $i$ 号点流入流量下界之和减流出流量下界之和，那么对于流入流量小于流出流量的点，可以将流出流量多的部分分到虚拟汇点上，同理流入流量多的点我们就流量分到虚拟源点，这样我们就强行维护了流量守恒，当然我们还需要对原网络的边的上界改为上界减下界，所以最终只要虚拟源点到虚拟汇点的最大流为满流，则就保证了原图的网络的边都可满足上下界，且流量守恒。下面我们证明新网络的正确性。</p>
<p>我们不妨设原图为 $G$，可行流为 $f$，新图为 $G’$，满流为 $f’$。</p>
<p>那么对于一个原图可行流 $f$，这个流在 $G$ 上满足容量限制和流量守恒，那么对于 $G’$ 上的每一个点的流量，我们形式化地表达：$\text{flow}(u)&#x3D;\sum\limits_{(v,u)\in E}(f(v,u)-\lim(v, u))-\sum\limits_{(u,v)\in E}(f(u,v)-\lim(u,v))+f’(S,u)-f’(u,T)$。</p>
<p>什么意思？就是在原图中有的那些边的流量，我们在新图中将它们的流量设为流量减下界，那么在新图中<strong>新增的边</strong>为<strong>每个点到虚拟源点&#x2F;虚拟汇点的边</strong>，那么 $f’(S,u)-f’(u,T)$ 应该为 $A_u$，而 $A_u$ 恰好就是流入流量下界之和减流出流量下界之和！则有：</p>
<p>$\text{flow}(u)&#x3D;\sum\limits_{(v,u)\in E}(f(v,u)-\lim(v, u))-\sum\limits_{(u,v)\in E}(f(u,v)-\lim(u,v))+A_u$</p>
<p>$&#x3D;\sum\limits_{(v,u)\in E}f(v,u)-\sum\limits_{(u,v)\in E}f(u,v)$</p>
<p>而由于 $f$ 是个可行流，所以最终相减的两部分是相等的，所以我们有 $\text{flow}(u)&#x3D;0$，即流 $f’$ 流量守恒，是一个可行流。当然容量限制一般是一定满足的，所以有时候会省略证明。</p>
<p>对于一个新图可行流 $f’$，这个流在 $G’$ 上满足容量限制和流量守恒，证明也是一个思路，把每个点那些流到源点和汇点的那些流量在扔回到其它连接这个点的边上，就能证明流量守恒，但是我们还需要注意一个限制：原图中每条边的下限限制。</p>
<p>这当然也是十分好说的，对于图 $G’$ 的每条不连接虚拟源点&#x2F;汇点的边，有 $0\leq f’(u,v)\leq c(u,v)-\lim(u,v)$，那么由于 $f’$ 是满流，所以肯定保证每条边都至少能分到 $\lim(u,v)$ 所以有 $\lim(u,v)\leq f’(u,v)+\lim(u,v)\leq c(u,v)$。</p>
<h3 id="LOJ-115-无源汇有上下界可行流"><a href="#LOJ-115-无源汇有上下界可行流" class="headerlink" title="LOJ#115. 无源汇有上下界可行流"></a><a target="_blank" rel="noopener" href="https://loj.ac/p/115">LOJ#115. 无源汇有上下界可行流</a></h3><p>最终流程：求 $A_i\rightarrow$ 建新的残留网络 $\rightarrow$ 跑最大流 $\rightarrow$ 判是否是满流</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> NetWork <span class="token punctuation">{</span>
    <span class="token keyword">int</span> ver<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> capacity<span class="token punctuation">,</span> nxt<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 注意可能会需要多记一个 limit</span>
    <span class="token keyword">void</span> <span class="token function">ins</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ver <span class="token operator">=</span> v<span class="token punctuation">,</span> limit <span class="token operator">=</span> l<span class="token punctuation">,</span> capacity <span class="token operator">=</span> w<span class="token punctuation">,</span> nxt <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span>
        head<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>Net<span class="token punctuation">[</span><span class="token number">20805</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span>
    s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> t <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> l<span class="token punctuation">,</span> w<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> u <span class="token operator">>></span> v <span class="token operator">>></span> l <span class="token operator">>></span> w<span class="token punctuation">;</span>
        Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> l<span class="token punctuation">,</span> w <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        A<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> l<span class="token punctuation">,</span> A<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> l<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 求 A[i]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 流入的下界流量之和大于流出的下界流量之和，建 s -> i 的边。</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sum <span class="token operator">+</span><span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 注意求一下满流大小。</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 反之建 i -> t 的边。</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Flow <span class="token operator">!=</span> sum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"NO\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"YES\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token operator">*</span> m<span class="token punctuation">;</span>i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 在输出原网络流的方案时，流量 = 新网络流量 + 边的流量下界。</span>
            cout <span class="token operator">&lt;&lt;</span> Net<span class="token punctuation">[</span>i <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>capacity <span class="token operator">+</span> Net<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>limit <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="有源汇上下界可行流"><a href="#有源汇上下界可行流" class="headerlink" title="有源汇上下界可行流"></a>有源汇上下界可行流</h2><p>有了源点和汇点之后，说明有两个点的流量守恒就不用满足了，那么考虑怎么转化为无源汇上下界可行流。</p>
<p>这里一个比较巧妙的操作是连 $t\rightarrow s$ 并将容量设为 $\text{Inf}$，此时我们发现原图的源点和汇点也可以满足要求，然后我们按无源汇上下界可行流做就行。</p>
<h2 id="有源汇上下界最小-x2F-大流"><a href="#有源汇上下界最小-x2F-大流" class="headerlink" title="有源汇上下界最小&#x2F;大流"></a>有源汇上下界最小&#x2F;大流</h2><p>一个十分复杂的题目（指证明）</p>
<p>我们可以轻易的求一个可行流，但是如何找到最小或最大流呢，做法十分之简单：按有源汇上下界可行流跑虚拟源点到虚拟汇点的最大流，然后把 $t\rightarrow s$ 的边在残留网络中删掉，然后跑 $s$ 到 $t$ 的最大流，最终的最大流就是第一部分的最大流加第二部分的最大流，如果是最小流就跑 $t$ 到 $s$ 的最大流，最小流就是第一部分的最大流减第二部分的最大流。</p>
<p>下面我们来证明一下。</p>
<p>我们设原图为 $G$，原图的一个可行流为 $f$，我们设<strong>按有源汇上下界可行流建出来的图为</strong> $G’$，一个满流为 $f’$，$G’$ 的残留网络记为 $G_{f’}$，残留网络的可行流为 $f_0$。</p>
<p>那么我们首先观察 $f_0+f’$ 的性质。不难发现，$f_0$ 中与虚拟源点和虚拟汇点相关的边的流量均为 $0$，因为 $f_0$ 是可行流，所以虚拟源点和虚拟汇点在源点和汇点分别是 $s$ 和 $t$ 的情况下，就变成了一个普通点，也是需要满足流量守恒的，而虚拟源点和虚拟汇点又分别都只能流出去流量和流进去流量，因此<strong>不可能再给它们流量</strong>，所以 $f_0+f’$ 仍然是一个满足容量限制的 $G’$ 的一个满流，且由 $f_0$ 我们可以得到，除了 $s$ 和 $t$ 外，其它点都是流量守恒的，而 $s$ 和 $t$ 通过 $G’$ 的 $t\rightarrow s$ 的反向边，也是可以满足流量守恒这一点的。因此，我们说，对于任意一个可行流 $f_0$，存在一个满流 $f’$，使得 $f_0+f’$ 是仍然是满流，这样就对应了原图 $G$ 的可行流 $f$。</p>
<p>那么接下来我们观察任意两个 $G’$ 的满流相减 $f’-f’’$。</p>
<p>考虑到两个满流都保证了虚拟源点流出的流量和虚拟汇点流入的流量是满的，那么相减之后<strong>这些有关虚拟源点和虚拟汇点的边的流量均变为了</strong> $0$，这是后续证明正确的重点。</p>
<p>那么我们看这个是否对应一个残留网络的可行流 $f_0$ 呢，答案是对应的。因为两个可行流相减肯定还是可行流（但注意这个减完得到的还是虚拟源点到虚拟汇点的可行流），且虚拟源点和虚拟汇点的边的流量都减到了 $0$，所以除去虚拟源点和虚拟汇点这两个点后，网络仍满足流量守恒，这就足以说明有一个 $f_0$ 的可行流。</p>
<p>所以综上，我们证明了：残留网络 $G_{f’}$ 上的可行流 $f_0$ 加上新图 $G’$ 的满流 $f’$ 就等价于一个原图的可行流 $f$。所以才有了开头那个看似十分感性但正确的做法。</p>
<h3 id="LOJ-116-有源汇有上下界最大流"><a href="#LOJ-116-有源汇有上下界最大流" class="headerlink" title="LOJ#116. 有源汇有上下界最大流"></a><a target="_blank" rel="noopener" href="https://loj.ac/p/116">LOJ#116. 有源汇有上下界最大流</a></h3><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> s <span class="token operator">>></span> t<span class="token punctuation">;</span>
    S <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> T <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> l<span class="token punctuation">,</span> w<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> u <span class="token operator">>></span> v <span class="token operator">>></span> l <span class="token operator">>></span> w<span class="token punctuation">;</span>
        Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> w <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        A<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> l<span class="token punctuation">,</span> A<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> i<span class="token punctuation">,</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> S<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sum <span class="token operator">+</span><span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token operator">-</span>A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
    Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> s<span class="token punctuation">,</span> I<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Net<span class="token punctuation">[</span><span class="token operator">++</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ins</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Flow <span class="token operator">&lt;</span> sum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"please go home to sleep\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> Net<span class="token punctuation">[</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span>capacity<span class="token punctuation">;</span>
        Net<span class="token punctuation">[</span>top<span class="token punctuation">]</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> Net<span class="token punctuation">[</span>top <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        S <span class="token operator">=</span> s<span class="token punctuation">,</span> T <span class="token operator">=</span> t<span class="token punctuation">;</span>
        Flow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> res <span class="token operator">+</span> Flow <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="使用最大流作为判定的问题"><a href="#使用最大流作为判定的问题" class="headerlink" title="使用最大流作为判定的问题"></a>使用最大流作为判定的问题</h2><h3 id="POJ-2455-Secret-Milking-Machine"><a href="#POJ-2455-Secret-Milking-Machine" class="headerlink" title="POJ#2455. Secret Milking Machine"></a><a target="_blank" rel="noopener" href="http://poj.org/problem?id=2455">POJ#2455. Secret Milking Machine</a></h3><p>求<strong>最长道路的最小可能长度</strong>，不难想到二分答案 $mid$，然后将 $&gt;mid$ 的边都删掉就是我们所有用的边。</p>
<p>将所有能用的边的流量设为 $1$，以 $1$ 为源点，$n$ 为汇点跑最大流，看最大流是否大于等于 $T$。</p>
<p>代码：<a target="_blank" rel="noopener" href="http://poj.org/showsource?solution_id=23967440">http://poj.org/showsource?solution_id=23967440</a></p>
<h3 id="P2754-CTSC1999-家园-x2F-星际转移问题"><a href="#P2754-CTSC1999-家园-x2F-星际转移问题" class="headerlink" title="P2754 [CTSC1999] 家园 &#x2F; 星际转移问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2754">P2754 [CTSC1999] 家园 &#x2F; 星际转移问题</a></h3><p>不难发现此题也有单调性，如果 $x$ 天满足，那么 $x+1$ 天也满足。</p>
<p>那么考虑如何判定，则我们需要将问题转化为一张流网络。本题采用了<strong>对每一天分层</strong>的思想建图，我们分几类边说明。</p>
<p>我们令地球编号为 $0$，月球编号为 $n+1$，其余太空站编号不变。定义 ${day,i}$ 表示第 $day$ 天的第 $i$ 个点。</p>
<ol>
<li>由于全部的人一开始都在地球，我们连一条 $(S,0)$，容量为 $Inf$ 的边，代表人从地球出发。</li>
<li>由于每个人可在他当前的太空站停留到下一天且没有人数的限制，我们连一条 $({day,i},{day+1,i})$，容量为 $Inf$ 的边，表示停留的情况。</li>
<li>如果一些人在某一天已经到达了 $n+1$ 号点，代表已经到达了终点，我们连一条 $({day,n+1},T)$，容量为 $Inf$ 的边，表示已经到达终点。</li>
<li>最后是有关太空船的连边，对于每一天，我们需要计算出每个船昨天停靠的太空站 $u$ 与今天停靠的太空船 $v$，且太空站有人数限制 $h$，那么连 $({day-1,u},{day,v})$，容量为 $h$ 的边，代表太空船运输的情况。</li>
</ol>
<p>这样我们就建好了整张图，可以发现这张图是与原问题等价的，那么我们每次往后加一天的边和点，跑最大流判断流量是否大于等于需要运输的人数 $k$，如果等于输出答案退出。</p>
<p>那么什么情况下无解？考虑如果有合法解当且仅当 $0$ 与 $n+1$ 连通，用并查集维护并判断一下就能知道。当然如果当天数足够大但也没有满足也可以说明无解。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101010280">https://www.luogu.com.cn/record/101010280</a></p>
<h2 id="拆点最大流问题"><a href="#拆点最大流问题" class="headerlink" title="拆点最大流问题"></a>拆点最大流问题</h2><p>在前面的问题中，我们了解到如果某条边有限制，那么直接修改这条边的容量就行，那么点上有限制该怎么做呢。我们可以考虑将一个点拆为<strong>入点</strong>和<strong>出点</strong>，之间用对应容量的边连接。</p>
<h3 id="P2891-USACO07OPEN-Dining-G"><a href="#P2891-USACO07OPEN-Dining-G" class="headerlink" title="P2891 [USACO07OPEN]Dining G"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2891">P2891 [USACO07OPEN]Dining G</a></h3><p>本题类似于一个二分图匹配，我们需要对每个奶牛各匹配<strong>两个</strong>物品，那么按之前的建图方式建图，源点向食品连边，食品向奶牛连边，奶牛向饮料连边，饮料向汇点连边就完成转化？</p>
<p>简单思考可知两者并不等价，因为没有限制一个奶牛只能拿一个食品和一个饮料，所以我们需要添加这个限制，我们将奶牛拆成两个点，一个连食品，一个连饮料，最终在这两个点之间连一条容量为 $1$ 的边，这样每个奶牛只能至多匹配一组，与原题意等价。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101026249">https://www.luogu.com.cn/record/101026249</a></p>
<h3 id="P2766-最长不下降子序列问题"><a href="#P2766-最长不下降子序列问题" class="headerlink" title="P2766 最长不下降子序列问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2766">P2766 最长不下降子序列问题</a></h3><p>首先我们设 $g_i$ 表示前 $i$ 个数选出的不下降子序列的最长题目，这是一个普及组动态规划，随便写过。</p>
<p>然后考虑如何去最多的数量。观察到对于一个长为 $s$ 的子序列 $p$，一定满足 $g_{p_i}&#x3D;i$，所以当且仅当一条流网络上恰好经过一条 $g$ 值为 $1\sim s$ 的路径才合法，那么可以想到如下建图方式：如果有 $j&lt;i,a_j\leq a_i,g_j+1&#x3D;g_i$，那么连一条 $j\rightarrow i$ 的容量为 $1$ 的边，源点向所有 $g_i&#x3D;1$ 的点连边，所有 $g_i&#x3D;s$ 的点向汇点连边，又因为每个数最多取一次，<strong>作为一个对于点的限制考虑拆点</strong>，这样我们就构造出了一个与原问题等价的流网络，求出最大流就是可选择的序列数。</p>
<p>当能使用多次 $a_1$ 和 $a_n$ 时，也就是我们破除了选择 $a_1$ 和 $a_n$ 的限制，将源点到 $1$ 的入点，$1$ 的入点到 $1$ 的出点，$n$ 的出点到汇点，$n$ 的入点到 $n$ 的出点的容量修改为 $Inf$ 即可。</p>
<p>注意当 $s&#x3D;1$ 时，修改为 $Inf$ 后可能会使最大流也变成 $Inf$，所以可以特判一下。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101026610">https://www.luogu.com.cn/record/101026610</a></p>
<h3 id="POJ-3498-March-of-the-Penguins"><a href="#POJ-3498-March-of-the-Penguins" class="headerlink" title="POJ#3498. March of the Penguins"></a><a target="_blank" rel="noopener" href="http://poj.org/problem?id=3498">POJ#3498. March of the Penguins</a></h3><p>我们分步骤将原问题转化为一个等价的流网络：</p>
<ul>
<li>一开始有一些企鹅在某些浮冰上：将源点向这些浮冰连容量为企鹅数量的边。</li>
<li>每个浮冰的起跳次数有限制：相当于对每个点的限制，将其拆为入点和出点，并连一条容量为跳跃次数的边。</li>
<li>距离小于等于 $D$ 的浮冰可以到达：枚举任意两个浮冰，看距离是否小于等于 $D$，然后向浮冰的出点向下一块的浮冰的入点连一条容量为 $Inf$ 的边。</li>
<li>找出所有可以汇合的浮冰：我们可以枚举一个点作为汇点，跑最大流看是否等于企鹅数量。</li>
</ul>
<p>代码：<a target="_blank" rel="noopener" href="http://poj.org/showsource?solution_id=23967744">http://poj.org/showsource?solution_id=23967744</a></p>
<h2 id="最大流建图实战"><a href="#最大流建图实战" class="headerlink" title="最大流建图实战"></a>最大流建图实战</h2><h3 id="SP4063-MPIGS-Sell-Pigs"><a href="#SP4063-MPIGS-Sell-Pigs" class="headerlink" title="SP4063 MPIGS - Sell Pigs"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP4063">SP4063 MPIGS - Sell Pigs</a></h3><p>我们考虑如果某个猪舍从未被打开过，那么第一个打开这个猪舍的顾客相当于有了第一次的购买权，而后打开的顾客可理解为是在买前几次顾客<strong>买剩下的猪</strong>。由于前几个顾客购买后拥有调整猪舍的权利，打开的猪舍相当于也可能会被新顾客购买，尽管新顾客可能不能打开某个猪圈。</p>
<p>这提示我们采用一种建图方式体现<strong>顾客之间的购买和调整的先后顺序</strong>。</p>
<p>因此我们按如下方式建边：</p>
<ul>
<li>如果某个顾客<strong>第一次打开一个猪舍</strong>，源点 $S$ 向这个猪舍连容量为此猪舍猪的数量大小的边。</li>
<li>如果某个顾客<strong>不是第一次打开一个猪舍</strong>，那么让<strong>上一个打开这个猪舍的顾客</strong>向这个顾客连边，容量为 $Inf$。</li>
<li>每个顾客向汇点 $T$ 连容量为顾客需求猪的数量大小的边。</li>
</ul>
<p>这样的思路正确性在于：保证了每个顾客在购买时打开的猪圈一定是在上一次顾客购买之后的，上一次顾客购买后的调整就相当于是顾客之间的连边。</p>
<p>最后我们跑最大流即为答案。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101030821">https://www.luogu.com.cn/record/101030821</a></p>
<h1 id="最小割算法"><a href="#最小割算法" class="headerlink" title="最小割算法"></a>最小割算法</h1><h2 id="text-Dinic-1"><a href="#text-Dinic-1" class="headerlink" title="$\text{Dinic}$"></a>$\text{Dinic}$</h2><p>由于最小割等于最大流，所以我们直接使用 $\text{Dinic}$ 求最大流，就是这个网络的最小割。</p>
<p>顺便说明一个最小割构造方式，由最大流最小割定理的证明过程，当我们求出一个可行流后，沿着所有剩余容量大于 $0$ 的点一直走到的所有点放到 $S$ 集合，其余放到 $T$ 集合，那么 $[S,T]$ 就是一个与当前可行流相等的割的容量。</p>
<p>代码略。</p>
<h1 id="最小割相关模型和例题"><a href="#最小割相关模型和例题" class="headerlink" title="最小割相关模型和例题"></a>最小割相关模型和例题</h1><h2 id="最小割直接应用"><a href="#最小割直接应用" class="headerlink" title="最小割直接应用"></a>最小割直接应用</h2><h3 id="AcWing2279-网络战争"><a href="#AcWing2279-网络战争" class="headerlink" title="AcWing2279. 网络战争"></a><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/2281/">AcWing2279. 网络战争</a></h3><p>对于平均最小边权，不难想到 01 分数规划的做法。</p>
<p>二分一个值 $mid$ 并判断是否可行，等价于判断 $\dfrac{\sum\limits_{e\in C}w_e}{|C|}\leq mid$。</p>
<p>移项后得 $\sum\limits_{e\in C}(w_e - mid)\leq 0$，由于本题中对于边割集的定义为删去这些边后 $s$ 和 $t$ 不连通，因此我们先将 $w_e\le mid$ 的边都选上，那么剩下的边中都为正权，为了最小化代价，我们选最小割即可。</p>
<p>注意精度问题。</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">double</span> lf<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">105</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">805</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lf eps <span class="token operator">=</span> <span class="token number">1e-4</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
lf flow<span class="token punctuation">;</span>
<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dep<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> cur<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
lf f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> head<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>dep<span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> dep<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> Inf <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dep<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>dep<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">!=</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

lf <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> lf flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">==</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> flow<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    lf used <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> cur<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cur<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> dep<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lf low <span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> flow <span class="token operator">-</span> used<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>low <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                used <span class="token operator">+</span><span class="token operator">=</span> low<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> low<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> low<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>used <span class="token operator">==</span> flow<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> used<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flow <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">chk</span><span class="token punctuation">(</span>lf mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> top<span class="token punctuation">;</span> i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            flow <span class="token operator">+</span><span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mid<span class="token punctuation">;</span>
            f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>i <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>i <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> flow <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> S <span class="token operator">>></span> T<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> w<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> u <span class="token operator">>></span> v <span class="token operator">>></span> w<span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    lf l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token number">1e7</span><span class="token punctuation">,</span> mid<span class="token punctuation">,</span> ans<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">-</span> l <span class="token operator">></span> eps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chk</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            r <span class="token operator">=</span> mid<span class="token punctuation">,</span> ans <span class="token operator">=</span> mid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            l <span class="token operator">=</span> mid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> ans <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="AcWing2280-最优标号"><a href="#AcWing2280-最优标号" class="headerlink" title="AcWing2280. 最优标号"></a><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/2282/">AcWing2280. 最优标号</a></h2><p>看到求异或值最大，不难想到拆位求的思路。</p>
<p>把每一位抠出来后，每个点的编号都只能是 $0$ 或 $1$。</p>
<p>那如何把 $0$ 和 $1$ 之间的异或值与割联系起来呢？</p>
<p>考虑到我们如果将割 $[S,T]$ 的 $S$ 集的权值都设为 $0$，$T$ 集的权值都设为 $1$，那么当且仅当只有连接 $0$ 和 $1$ 的边会有贡献，也就是割的割边，所以最小值就是最小割。</p>
<p>注意一些点可能已经被设权值，要提前先加入 $S&#x2F;T$  割集中。</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">long</span> ll<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">505</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">7005</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> edge<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> a<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
ll flow<span class="token punctuation">;</span>
<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dep<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> cur<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> head<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>dep<span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> dep<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> Inf <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dep<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>dep<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">!=</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">==</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> flow<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> used <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> cur<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cur<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> dep<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> flow <span class="token operator">-</span> used<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>low <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                used <span class="token operator">+</span><span class="token operator">=</span> low<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> low<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> low<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>used <span class="token operator">==</span> flow<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                dep<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> used<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> edge<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> v <span class="token operator">=</span> edge<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
        e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
        e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> j <span class="token operator">&amp;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> T<span class="token punctuation">,</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">add</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> i<span class="token punctuation">,</span> Inf<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Dinic</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">build</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flow <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token function">dfs</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> Inf<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span>
    S <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> T <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    
    <span class="token function">memset</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cin <span class="token operator">>></span> edge<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">>></span> edge<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> k<span class="token punctuation">;</span>
    cin <span class="token operator">>></span> k<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>k<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u<span class="token punctuation">,</span> p<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> u <span class="token operator">>></span> p<span class="token punctuation">;</span>
        a<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">31</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Dinic</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cout <span class="token operator">&lt;&lt;</span> flow <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="最大权闭合图"><a href="#最大权闭合图" class="headerlink" title="最大权闭合图"></a>最大权闭合图</h2><p>对于一张图 $G&#x3D;(V,E)$，每个点有一个点权，我们定义：</p>
<p>一个闭合图指从图中选出一些点构成集合 $S$，使得 $\forall u\in S,(u,v)\in E$，有 $v\in S$，我们可称这样的点集 $S$ 或点集 $S$ 与里面的边集合起来是一个闭合图。</p>
<p>一个闭合图的权是闭合图点集中的点权之和。</p>
<p>最大权闭合图就是所有闭合图中权值最大的那个。</p>
<p>这个问题与最小割有什么联系？我们先说网络建法：对于图中的原先的边，在网络中添加容量为 $Inf$ 的边。对于权值大于 $0$ 的点，再从虚拟源点向这个点连容量为这个点点权大小的边，对于权值小于等于 $0$ 的点，再从这个点向虚拟汇点连容量为这个点点权相反数大小的边。</p>
<p><img src="https://cdnjson.com/images/2022/12/18/5b6f0d6dbda6d4ed3fb5bdbbf297c93d.png" alt="最大权闭合图"></p>
<p>我们定义一个特殊的割叫做<strong>简单割</strong>，表示所有的割边都跟源点和汇点相连。那么按上述方式建的网络的最小割是不是简单割呢，由最大流最小割定理，最小割等于最大流，而最大流是有限的，则割边不可能包括中间容量为 $Inf$ 的边。</p>
<p>接下来我们要证明闭合图与简单割一一对应。对于一个闭合子图，记它的点集为 $V’$，我们构造割 $[S,T]$，$S&#x3D;{s}+V’,T&#x3D;V\backslash S+{t}$。而又因为 $V’$ 构成一个闭合图，那么从 $V’$ 中的点怎么走，最终还是只能走到 $V’$ 集合，也就是不可能通过那些容量 $Inf$ 的边从 $S$ 走到 $T$，那么割边不包括容量 $Inf$ 的边，即这是一个简单割。</p>
<p>那么对于一个简单割 $[S,T]$ ，由于不存在容量 $Inf$ 的割边，所以 $S$ 中的点也只能走到 $S$ 中的点，所以是一个闭合图。</p>
<p>那么闭合图的权到底和这个简单割的容量的有什么关系？</p>
<p>设 $S&#x3D;{s}+V_S,T&#x3D;{t}+V_T$，我们看如下四类割边各自造成的贡献：</p>
<ol>
<li>$s\rightarrow t$，虚拟源点到虚拟汇点没有直接的边，没有贡献。</li>
<li>$V_S\rightarrow V_T$，由于是<strong>简单割</strong>，所以没有贡献。</li>
<li>$s\rightarrow V_T$，每条割边的容量对应割中的那些正权点的权值，所以这块贡献为正权点权值之和。</li>
<li>$V_S\rightarrow t$，每条割边的容量对应割中的那些负权点的权值，所以这块贡献为负权点权值之和。</li>
</ol>
<p>所以最后写成式子就是：$c(S,T)&#x3D;\sum\limits_{v\in V_T^+}w_v+\sum\limits_{v\in V_S^-}(-w_v)$。</p>
<p>我们去看 $V_S$ 构成的闭合子图的权值：</p>
<p>$w(V_S)&#x3D;\sum\limits_{v\in V_S^+}w_v-\sum\limits_{v\in V_S^-}(-w_v)$</p>
<p>$&#x3D;\sum\limits_{v\in V_S^+}w_v+\sum\limits_{v\in V_T^+}w_v-c(S,T)$</p>
<p>$&#x3D;\sum\limits_{v\in V}w_v-c(S,T)$</p>
<p>则 $V_S$ 的权值是<strong>所有点的权值之和减去简单割的容量</strong>，那么什么时候有最大值呢，<strong>当求得最小割的时候</strong>。</p>
<p>至此完成证明。</p>
<h2 id="NOI2006-最大获利"><a href="#NOI2006-最大获利" class="headerlink" title="[NOI2006] 最大获利"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4174">[NOI2006] 最大获利</a></h2><p>本题中如果把建设中转站的费用看作负权点，用户收益看作正权点的话，我们可以转化为最大权闭合图问题。</p>
<p>我们只需向每个用户群和对应的两个中转站连边，当且仅当两个中转站都选了，这个用户群才能选，所以从每个用户群出发得保证走到两个中转站，所以是个闭合子图。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101110660">https://www.luogu.com.cn/record/101110660</a></p>
<h2 id="最大密度子图"><a href="#最大密度子图" class="headerlink" title="最大密度子图"></a>最大密度子图</h2><p>对于一个点集 $V$，$E&#x3D;{(u,v)|u\in V, v\in V}$，则这个子图对应密度为 $\dfrac{|E|}{|V|}$，那么如何求对于一个图中的最大密度子图。</p>
<p>看到除法，我们使用 01 分数规划，判定 $\dfrac{|E|}{|V|}\ge g$。</p>
<p>$|E|-g\cdot |V|\ge 0$，我们要最大化 $|E|-g\cdot |V|$，也就是最小化 $g\cdot |V|-|E|$。</p>
<p>$g\cdot |V|-|E|&#x3D;\sum\limits_{v\in V}g-(\dfrac{\sum\limits_{v\in V}d_v}{2}-\dfrac{c(V,V’)}{2})$，其中 $V’$ 是点的全集和 $V$ 的差集，$d_u$ 是 $u$ 点的度。	</p>
<p>我们把系数提到前面得到 $\dfrac{1}{2}(\sum\limits_{v\in V}(g-d_v)+c(V,V’))$，观察到有 $c(V,V’)$ 这样的割的容量的部分，但是我们如何去把前面那项结合起来？</p>
<p>于是有了如下的建图：从源点向每个点连容量为 $U$ 的边，从每个点向汇点连容量为 $U+2g-d_v$ 的边，原图中的边的容量均为 $1$。$U$ 是为了放置边的容量爆负加的偏移量。</p>
<p>我们还是分类算割的容量：</p>
<ol>
<li>$s\rightarrow t$，没有，无贡献。</li>
<li>$s\rightarrow V’$，每条的容量为 $U$。</li>
<li>$V\rightarrow t$，每条的容量为 $U+2g-d_v$。</li>
<li>$V\rightarrow V’$，每条的容量均为 $1$。</li>
</ol>
<p>$c(V,V’)&#x3D;\sum\limits_{v\in V’}U+\sum\limits_{v\in V}(U+2g-d_v)+\sum\limits_{u\in V}\sum\limits_{v\in V’}c(u,v)$</p>
<p>$&#x3D;U\cdot n +2g\sum\limits_{v\in V’}1-\sum\limits_{u\in V}\sum\limits_{v\in V}c(u,v)$</p>
<p>$&#x3D;U\cdot n+2g|V|-2|E|$</p>
<p>这样我们只需最小化 $c(V,V’)$，就能最小化 $g\cdot |V|-|E|$。</p>
<h2 id="最小点权覆盖集"><a href="#最小点权覆盖集" class="headerlink" title="最小点权覆盖集"></a>最小点权覆盖集</h2><p>最小点权覆盖集指的是对于一个图 $G$，每个点有权值，找到一个最小的点权和的点集 $V$，使得原图中的每一条边的两个端点都<strong>至少</strong> $1$ <strong>个</strong>在点集 $V$ 中。</p>
<p>在一般图中，最小点权覆盖集中是 NP-完全问题，但在二分图中，我们可以使用最小割来求解，因此下列所用算法仅适用于二分图。</p>
<p><img src="https://cdnjson.com/images/2023/01/29/image.png" alt="最小点权覆盖集.png"></p>
<p>我们对于一个二分图，而如下方式建出网络，由于最小割求的是割边容量的最小值，而最小点权覆盖集对应的是点权值最小，那么我们希望将割边限定在 $S\rightarrow X$ 以及 $Y\rightarrow T$ 的边中，这样我们说一条割边对应了一个需要选择的点，这就解释了我们的建图方式：$S$ 向 $X$ 点集中每个点连容量为每个点权的边，$Y$ 向 $T$ 点集中每个点连容量为每个点权的边，$X$ 向 $Y$ 的边均设定为正无穷，<strong>这样割边就不会出现在这里</strong>，此时可以证明一个<strong>简单割</strong>（类似于最大权闭合图的定义，指不包括 $X\rightarrow Y$ 割边的割）对应一个<strong>极小的</strong>点覆盖集（证明略），而<strong>简单割</strong>的最小割是所有割的最小割，因此直接在上面的网络找最小割即为答案。</p>
<h2 id="最大点权独立集"><a href="#最大点权独立集" class="headerlink" title="最大点权独立集"></a>最大点权独立集</h2><p>最大点权独立集是最小点权覆盖集的<strong>对偶问题</strong>，当每个点的权值均为 $1$ 时，有最小点权覆盖集 $&#x3D;$ $n-$ 最大点权独立集。</p>
<p>而当权值不为 $1$ 时，这个结论同样成立，即最小点权覆盖集 $&#x3D;$ 所有点权和 $-$ 最大点权独立集。</p>
<p>证明从双方向证明：</p>
<ul>
<li>若 $V_1$ 是点覆盖集，那么 $V_2&#x3D;V-V_1$ 是独立集。</li>
<li>若 $V_2$ 是独立集，那么 $V_1&#x3D;V-V_2$ 是点覆盖集。</li>
</ul>
<p>用反证法可以轻易的证明出来，因此沿用最小点权覆盖集的方法做即可。</p>
<h3 id="P4474-王者之剑"><a href="#P4474-王者之剑" class="headerlink" title="P4474 王者之剑"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4474">P4474 王者之剑</a></h3><p>这题我们先从性质出发：</p>
<ol>
<li>只能在偶数秒捡宝石。我们只需证奇数秒时所在的格子一定没有宝石即可，如果上一秒动了，那么在上一秒时此格子已经被清空，而如果上一秒原地不动，那么此时的宝石应该已经在上一秒被拿走，无论什么情况，奇数秒所在的格子没有宝石，因此只能在偶数秒捡宝石。</li>
<li>相邻的格子不可能同时拿到。显然易证。</li>
</ol>
<p>根据这 $2$ 个性质，不难猜测本题是选择一个独立集。我们将方格图黑白染色，而边都是在黑点和白点之间的，因此图是一个二分图，而不能选相邻的格子就说明我们选择的是一个独立集，本题可以证明一个独立集选择方案能够一一对应一个合法的拿宝石方案，那么这样在最终的网络跑最大点权独立集即可。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101111765">https://www.luogu.com.cn/record/101111765</a></p>
<h1 id="费用流算法"><a href="#费用流算法" class="headerlink" title="费用流算法"></a>费用流算法</h1><p>费用流的定义其实非常简单，我们在每条边上添加了一个费用 $w$，表示每单位流量经过这条边所需的花费，那么对于一个网络的某个可行流，我们定义这个可行流的费用为所有边的花费之和。那么我们希望求<strong>最小费用最大流&#x2F;最小流</strong>。</p>
<h2 id="text-Edmonds-Karp-1"><a href="#text-Edmonds-Karp-1" class="headerlink" title="$\text{Edmonds Karp}$"></a>$\text{Edmonds Karp}$</h2><p>在求最大流中，我们使用 <code>bfs()</code> 来找到一条增广路增广，由最大流最小割定理，这个算法是正确的，而对于最小费用最大流，我们只需将 <code>bfs()</code> 换成 <code>spfa()</code>，每次找的是残留网络的最短费用路，然后用这条路增广即可。</p>
<p>注意图中不能出现负环，出现负环请参考<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P7173">P7173 【模板】有负圈的费用流</a>。</p>
<h3 id="时间复杂度-2"><a href="#时间复杂度-2" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>还是 $\mathcal{O}(nm^2)$。总之应该没人卡。</p>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">5005</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">100005</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
<span class="token keyword">int</span> flow<span class="token punctuation">,</span> cost<span class="token punctuation">;</span>

<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> pre<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> inque<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>d<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">spfa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>dis<span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> dis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>incf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> incf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> dis<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> N<span class="token punctuation">)</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        inque<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">></span> dis<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dis<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                pre<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                incf<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>incf<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>inque<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>tt <span class="token operator">==</span> N<span class="token punctuation">)</span> tt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    inque<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">spfa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> t <span class="token operator">=</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        flow <span class="token operator">+</span><span class="token operator">=</span> t<span class="token punctuation">,</span> cost <span class="token operator">+</span><span class="token operator">=</span> t <span class="token operator">*</span> dis<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> T<span class="token punctuation">;</span> u <span class="token operator">!=</span> S<span class="token punctuation">;</span> u <span class="token operator">=</span> e<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> t<span class="token punctuation">,</span> f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> m <span class="token operator">>></span> S <span class="token operator">>></span> T<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> a <span class="token operator">>></span> b <span class="token operator">>></span> c <span class="token operator">>></span> d<span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> flow <span class="token operator">&lt;&lt;</span> <span class="token string">' '</span> <span class="token operator">&lt;&lt;</span> cost <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="text-Dinic-2"><a href="#text-Dinic-2" class="headerlink" title="$\text{Dinic}$"></a>$\text{Dinic}$</h2><p>在 <code>spfa()</code> 后多路增广，复杂度仍为 $\mathcal{O}(nm^2)$，但优化了时间常数。</p>
<p><del>感觉没啥用就不写了。</del></p>
<h1 id="费用流相关模型和例题"><a href="#费用流相关模型和例题" class="headerlink" title="费用流相关模型和例题"></a>费用流相关模型和例题</h1><h2 id="直接运用"><a href="#直接运用" class="headerlink" title="直接运用"></a>直接运用</h2><h3 id="P4015-运输问题"><a href="#P4015-运输问题" class="headerlink" title="P4015 运输问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4015">P4015 运输问题</a></h3><p>对于每个仓库 $i$，从源点 $S$ 向仓库 $i$ 连容量为 $a_i$，费用为 $0$ 的边；对于每个商店 $j$，从商店 $j$ 向汇点 $T$ 连容量为 $b_j$，费用为 $0$ 的边。</p>
<p>最后，向仓库 $i$ 到商店 $j$ 连容量为 $0$，费用为 $c_{i,j}$ 的边，在此网络上跑最小&#x2F;最大费用最大流即可。</p>
<p>对于求最大费用最大流，可以将所有边的权值取相反数，求最小费用最大流后将所求费用再求相反数即可。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101131411">https://www.luogu.com.cn/record/101131411</a></p>
<h3 id="P4016-负载平衡问题"><a href="#P4016-负载平衡问题" class="headerlink" title="P4016 负载平衡问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4016">P4016 负载平衡问题</a></h3><p>首先根据贪心，必定是将高于平均的仓库中货物转到低于平均的仓库。</p>
<p>那么我们从源点 $S$ 向每一个高于平均的仓库连容量为 $a_i-ave$，费用为 $0$ 的边，从每一个低于平均的仓库向汇点连容量为 $ave-a_i$，费用为 $0$ 的边。</p>
<p>最后在相邻两个仓库之间连容量 $Inf$，费用为 $1$ 的边，这样任意一个满流就对应一个合法的搬运方案。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101131507">https://www.luogu.com.cn/record/101131507</a></p>
<h2 id="二分图最优匹配"><a href="#二分图最优匹配" class="headerlink" title="二分图最优匹配"></a>二分图最优匹配</h2><h3 id="P4014-分配问题"><a href="#P4014-分配问题" class="headerlink" title="P4014 分配问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4014">P4014 分配问题</a></h3><p>跟<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4015">P4015 运输问题</a>差不多，把源点和汇点的边容量都改为 $1$ 就行。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101131608">https://www.luogu.com.cn/record/101131608</a></p>
<h2 id="费用流之最大权不相交路径"><a href="#费用流之最大权不相交路径" class="headerlink" title="费用流之最大权不相交路径"></a>费用流之最大权不相交路径</h2><h3 id="P4013-数字梯形问题"><a href="#P4013-数字梯形问题" class="headerlink" title="P4013 数字梯形问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4013">P4013 数字梯形问题</a></h3><p>针对于路径不相交，我们只需将对应的路径容量设为 $1$，就能保证此边只会被至多一条路径增广。</p>
<p>针对于点不相交，我们想到了在最大流学到的拆点技巧，将其分为入点和出点，在入点和出点连一条容量为 $1$ 的边，这样就能使至多一条路径经过此点。</p>
<p>从不相交改到相交时，注意将相应边的容量放开即可。</p>
<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101131742">https://www.luogu.com.cn/record/101131742</a></p>
<h2 id="网格图模型"><a href="#网格图模型" class="headerlink" title="网格图模型"></a>网格图模型</h2><h3 id="AcWing382-K取方格数"><a href="#AcWing382-K取方格数" class="headerlink" title="AcWing382. K取方格数"></a><a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/384/">AcWing382. K取方格数</a></h3><p>本题中唯一一个难点：“若多条路线重复经过一个格子，只取一次”。也就是说，我们既要保证这个格子能被走多次，还要保证这个格子又一次代价能被计算到。</p>
<p>那么我们可以将格子拆点，从入点向出点连两条边，一条容量为 $Inf$，费用为 $0$，一条容量为 $1$，费用为 $Val_{i,j}$。这样就惊喜的发现解决了我们的要求。</p>
<p>最后我们总结一些建图方式对应的意义：</p>
<ul>
<li>连一条容量为 $Inf$ 的边：某条边可以重复经过。</li>
<li>连一条容量为 $1$ 的边：某条边仅能经过 $1$ 次。</li>
<li>入点向出点连一条容量为 $1$ 的边：某个点仅能经过 $1$ 次。</li>
<li>入点向出点连一条容量为 $Inf$，费用为 $w$ 的边：某个点可经过任意次，且每次经过均有价值 $w$。</li>
<li>入点向出点连一条容量为 $1$，费用为 $w$ 的边：某个点只有 $1$ 次价值 $w$ <strong>且仅能经过</strong> $1$ <strong>次</strong>。</li>
<li>入点向出点连一条容量为 $1$，费用为 $w$ 的边，和一条容量为 $Inf$，费用为 $0$ 的边：某个点可经过任意次，<strong>只计算</strong> $1$ <strong>次价值</strong>。</li>
</ul>
<pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">5005</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> n<span class="token punctuation">,</span> k<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
<span class="token keyword">int</span> cost<span class="token punctuation">;</span>
<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> pre<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> inque<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>d<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">spfa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>dis<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> dis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>incf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> incf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> dis<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> N<span class="token punctuation">)</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        inque<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&lt;</span> dis<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dis<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                pre<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                incf<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>incf<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>inque<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>tt <span class="token operator">==</span> N<span class="token punctuation">)</span> tt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    inque<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">spfa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> t <span class="token operator">=</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cost <span class="token operator">+</span><span class="token operator">=</span> t <span class="token operator">*</span> dis<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> T<span class="token punctuation">;</span> u <span class="token operator">!=</span> S<span class="token punctuation">;</span> u <span class="token operator">=</span> e<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> t<span class="token punctuation">,</span> f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> n <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> n <span class="token operator">>></span> k<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    S <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> T <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> c<span class="token punctuation">;</span>
            cin <span class="token operator">>></span> c<span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Inf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> Inf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> Inf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> cost <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="AcWing2195-深海机器人问题"><a href="#AcWing2195-深海机器人问题" class="headerlink" title="AcWing2195. 深海机器人问题"></a><a target="_blank" rel="noopener" href="https://www.acwing.com/activity/content/problem/content/2688/">AcWing2195. 深海机器人问题</a></h3><p>我们考虑对于每个初始有机器人的格子作为出发点连源点 $S$，而目的地作为结束点连汇点 $T$。而题目要求“到达目的地的机器人尽可能多的情况下，最高收益是多少”，那么我们自然将其对应为最大费用最大流，我们把网格上相邻的边对应到网络中边的费用即可。</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">270</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">,</span> Inf <span class="token operator">=</span> <span class="token number">0x3f3f3f3f</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>
<span class="token keyword">int</span> cost<span class="token punctuation">;</span>
<span class="token keyword">int</span> head<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> top<span class="token punctuation">;</span>
<span class="token keyword">int</span> que<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> pre<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> inque<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span> f<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>d<span class="token punctuation">,</span> nxt<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> head<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">spfa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>dis<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> dis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>incf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> incf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    que<span class="token punctuation">[</span>hh<span class="token punctuation">]</span> <span class="token operator">=</span> S<span class="token punctuation">,</span> dis<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> incf<span class="token punctuation">[</span>S<span class="token punctuation">]</span> <span class="token operator">=</span> Inf<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>hh <span class="token operator">!=</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> u <span class="token operator">=</span> que<span class="token punctuation">[</span>hh<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>hh <span class="token operator">==</span> N<span class="token punctuation">)</span> hh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        inque<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> head<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">~</span>i<span class="token punctuation">;</span> i <span class="token operator">=</span> nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&lt;</span> dis<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> dis<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                pre<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                incf<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>incf<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>inque<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    que<span class="token punctuation">[</span>tt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>tt <span class="token operator">==</span> N<span class="token punctuation">)</span> tt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    inque<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">spfa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> t <span class="token operator">=</span> incf<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cost <span class="token operator">+</span><span class="token operator">=</span> t <span class="token operator">*</span> dis<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> u <span class="token operator">=</span> T<span class="token punctuation">;</span> u <span class="token operator">!=</span> S<span class="token punctuation">;</span> u <span class="token operator">=</span> e<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">=</span> t<span class="token punctuation">,</span> f<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token operator">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    cin <span class="token operator">>></span> a <span class="token operator">>></span> b <span class="token operator">>></span> n <span class="token operator">>></span> m<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    S <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> T <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> c<span class="token punctuation">;</span>
            cin <span class="token operator">>></span> c<span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Inf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> c<span class="token punctuation">;</span>
            cin <span class="token operator">>></span> c<span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> Inf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> a<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> k<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> k <span class="token operator">>></span> x <span class="token operator">>></span> y<span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> b<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> r<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
        cin <span class="token operator">>></span> r <span class="token operator">>></span> x <span class="token operator">>></span> y<span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> T<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">EdmondsKarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> cost <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
    
    cout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="拆点"><a href="#拆点" class="headerlink" title="拆点"></a>拆点</h2><h3 id="P1251-餐巾计划问题"><a href="#P1251-餐巾计划问题" class="headerlink" title="P1251 餐巾计划问题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1251">P1251 餐巾计划问题</a></h3><p>本题中要注意我们将每一天的餐巾拆分为“用完的旧餐巾”和“需要的新餐巾”，然后我们对于“需要的新餐巾”向汇点连容量 $r_i$，费用为 $0$ 的边，因此我们限制了“需要的新餐巾”数量，从而使任意一个满流对应了一个餐巾	的方案，跑最小费用最大流即可。</p>
<p>而其余的不同情况的连边，参考下图。</p>
<img src="https://cdnjson.com/images/2023/01/30/91cf01654cfe92d02cf544be99b7d03d.png" alt="餐巾计划问题.png" style="zoom:90%;" />

<p>代码：<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/101132505">https://www.luogu.com.cn/record/101132505</a></p>
<h2 id="无源汇有上下界最小费用可行流问题"><a href="#无源汇有上下界最小费用可行流问题" class="headerlink" title="无源汇有上下界最小费用可行流问题"></a>无源汇有上下界最小费用可行流问题</h2><h3 id="P3980-NOI2008-志愿者招募"><a href="#P3980-NOI2008-志愿者招募" class="headerlink" title="P3980 [NOI2008] 志愿者招募"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3980">P3980 [NOI2008] 志愿者招募</a></h3><p>我们先按如下方式建出网络：</p>
<p><img src="https://cdnjson.com/images/2023/01/30/e04ac050a786a300ec56ab50c10eead5.png" alt="志愿者招募.png"></p>
<p>其中第 $i$ 号点和 $(i+1)$ 号点的边就表示第 $i$ 天志愿者<strong>变化的人数</strong>。（可以为负值）</p>
<p>红色的边是指每类志愿者的工作区间 $[s_i,t_i]$ 会在边上凭空产生 $1$ 的流量，为了满足流量守恒，我们建反边形成回路就能平衡流量。</p>
<p>那么我们说<strong>每条边的容量均有下界值</strong>，因为如果小于下界，那么下一天的志愿者人数就不能满足要求。这是一个无源汇有上下界最小费用可行流问题，如何求解？</p>
<p>参考无源汇有上下界可行流的做法，我们对于每个点，统计进入这个点的容量 $c_入$ 和流出这个点的容量 $c_出$，若 $c_入&gt;c_出$，从 $S$ 到这个点连容量 $c_入-c_出$ 的边，反之从这个点向 $T$ 连容量 $c_出-c_入$ 的边即满足流量守恒。当然本题实际上我们是把每条边看作一个新网络上的点，而 $c_入$ 就是这个边左边的端点对应的人数，$c_出$ 就是这个边右边的端点对应的人数。</p>
<p>对按这种方式建成的新网络求最小费用最大流就是原问题的答案。</p>

            <div id="vcomments"></div>
        </div>

        <div id = "toc">
        </div>

        <script>
            new Valine({
                el: '#vcomments',
                appId: 'CEGJD6I3uLgJeTF6fPsqgGmw-gzGzoHsz',
                appKey: 'R3wowhGv7IL3peB3tT06CjzS',
                visitor: true,
                master: '28a6ec927125219298a15dcb5c104f67'
            })
        </script>

    

</div>

</body>