<head>
    <title> U143101 [1028T2]三千世界 - WyyOIer </title><meta name="robots" content="noindex">
  	<link rel="stylesheet" href="/css/main.css">
  	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script type = "text/javascript" async src="/javascript/main.js"></script>
    <script id="MathJax-script" async src="/javascript/math/tex-mml-chtml.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>


   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeBlockFuction.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeCopy.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/clipboard.min.js"></script> -->
   <!-- <script type="text/javascript" src="/javascript/codeBlocks/codeShrink.js"></script> -->
   <!-- <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style> -->

    <!-- <link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css"> -->
    
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <script id="Valine" src='https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js'></script>
<meta name="generator" content="Hexo 6.2.0"><link rel="stylesheet" href="/css/prism-sh.css" type="text/css"></head>

<body>


<div id = "background">
    <div id = "index">
        <div id="menu">

    <div style="text-align: center;font-size: 32px;font-family: consolas;">
        <p>WyyOIer</p>
    </div>

    <div style="height: 150px;float: up;display: flex;flex-direction: column;align-items: center;">
        <div id="headstyle">
            
        </div>
    </div>
	
    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "pcount" title = "文章数" style = "font-family: consolas;font-size: 20px;">21</text>
    </div>

    <div style="height: 50px;width: 30%;float: left;text-align: center;">
        <text id = "commentcount" title = "评论数" style = "font-family: consolas;font-size: 20px;">0</text>
    </div>

    <div style="height: 50px;width: 40%;float: left;text-align: center;">
        <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/159610">
        <img src="https://www.luogu.com.cn/favicon.ico" alt="洛谷" width="24" height="24"></a>
        &nbsp; 
        <a target="_blank" rel="noopener" href="https://codeforces.com/profile/WyyOIer">
        <img src="https://codeforces.com/favicon.ico" alt="CF" width="24" height="24"></a>
    </div>


    <div class="list-group">
        <a class="list-group-item" href="/"><i class="fa fa-home fa-fw"></i>&nbsp; 首页</a>
        <a class="list-group-item" href="/about"><i class="fa fa-user fa-fw"></i>&nbsp; 关于</a>
        <a class="list-group-item" href="/links"><i class="fa fa-link fa-fw"></i>&nbsp; 友链</a>
        <a class="list-group-item" onclick = "Search()"><i class="fa fa-search fa-fw"></i>&nbsp; 搜索</a>
        <a class="list-group-item" href="/source"><i class="fa fa-code fa-fw"></i>&nbsp; 代码</a>
        <a class="list-group-item" href="/config"><i class="fa fa-cog fa-fw"></i>&nbsp; 设置</a>
    </div>

    <script>
        function changemusicid(){
            var v = document.getElementById("num").value, text, f = 0;
            if(v == null || v == "") {
            text = "输入不能为空。";
            f = 1;
            }
            if(f == 0) document.getElementById("music").innerHTML= '<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=250 height=95 src="//music.163.com/outchain/player?type=2&id=' + v + '&auto=0&height=66"></iframe> ';
            else document.getElementById("musictext").innerHTML = text;
        }
    </script>

    <div style="height: 13%;width: 30%;float: left" id="music">
    <!-- <input id = "num" placeholder = "输入网易音乐 id，如 480517594" style = "width: 230px;"> -->
    <!-- <button type="button" onclick="changemusicid()">提交</button> -->
    <!-- <p id = "musictext"></p> -->
    </div>

</div>


    </div>

    

    


    

        <div id = "article">
            <div id = "post-title"> U143101 [1028T2]三千世界 </div>
            <div id = "post-author"> By WyyOIer | </div>
            <div id = "post-date" title = "发布时间"> 2022-11-20 16:21:44 / </div>
            <div id = "post-updated" title = "更新时间"> 2022-11-20 16:46:07 </div>
            <span class = "leancloud_visitors" id = "/2022/11/20/U143101-1028T2-%E4%B8%89%E5%8D%83%E4%B8%96%E7%95%8C/">
                <text class="post-meta-item-text">阅读数 </text>
                <i class="leancloud-visitors-count">nan</i>
            </span>
            <br>
            <p>这题场上想的其实是一个与正解类似的状态：$dp_{u,j,x}$ 表示 $u$ 子树内，与 $u$ 联通的点的未被选的有 $j$ 个，答案为 $x$ 的方案数，这个相信是一个正常计数 dp 的思路，但是场上一直挂大样例，最终导致策略的失误。</p>
<p>不难观察到，如果给定一个路径集合 $S$，那么 $f(S)$ 的构造方案就是每次选择最近公共祖先最深的路径，然后封掉这个子树继续选，那么有没有一个合适的状态记录在 dp 里呢？</p>
<p>考虑 $f_{u,j}$ 表示 $u$ 子树内，与 $u$ 联通的点的数量为 $j$ 的<strong>局面的概率</strong>，因为<strong>观察到最终的答案是</strong> $p(S)*f(S)$ 的形式，所以求出概率也是此题的关键。</p>
<p>特别地，当 $j&#x3D;0$，即代表 $u$ 已经被选，子树内的任何选择都不会使 $j$ 从 $0$ 变大。</p>
<p>这是一个树上背包模型，初始只有 $u$ 一个根节点时，有选和不选两种情况，对应初始情况 $f_{u,0}&#x3D;f_{u,1}&#x3D;\dfrac{1}{2}$。</p>
<p>在我们将 $v$ 子树合并至 $u$ 子树时，设 $v$ 子树有 $k$ 个与 $v$ 联通，$u$ 子树有 $j$ 个与 $u$ 联通，考虑两种情形：</p>
<ul>
<li><strong>不会使答案变化的选择</strong>。考虑有 $2jk$ 的选择能造成贡献，那么<strong>任何一个选择都作为一个</strong> $\dfrac{1}{2}$ <strong>的可能条件</strong>，那么就会有 $2^{-2jk}$ 的可能不造成答案变化。 $f_{u,j}*f_{v,k}*2^{-2jk}\rightarrow f_{u’,j+k}$</li>
<li><strong>使答案变化</strong> $(+1)$ <strong>的选择</strong>。自然是剩余的 $(1-2^{-2jk})$ 的概率了。注意这样的话新的路径的选择的最近公共祖先是 $u$，所以就不会再有与 $u$ 联通的未选择的点了。 $f_{u,j}*f_{v,k}*(1-2^{-2jk})\rightarrow f_{u’,0}$</li>
<li>注意当 $j&#x3D;0$ 的情况，无论如何选择都会贡献给合并后新的子树的 $j’&#x3D;0$，概率为 $1$。 $f_{u,0}*f_{v,k}*1\rightarrow f_{u’,0}$</li>
</ul>
<p>由于最终所有对答案的贡献都加到了 $f_{u,0}$ 上，最终答案就是 $2^{n^2}\sum\limits_{u}f_{u,0}$，别忘了 $f$ 是概率，要乘 $2^{n^2}$。</p>
<!-- flag of hidden posts -->
            <div id="vcomments"></div>
        </div>

        <div id = "toc">
        </div>

        <script>
            new Valine({
                el: '#vcomments',
                appId: 'CEGJD6I3uLgJeTF6fPsqgGmw-gzGzoHsz',
                appKey: 'R3wowhGv7IL3peB3tT06CjzS',
                visitor: true,
                master: '28a6ec927125219298a15dcb5c104f67'
            })
        </script>

    

</div>

</body>